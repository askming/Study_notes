
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>[book] Causal Inference: What If &#8212; Study Notes</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script src="https://wavedrom.com/skins/default.js"></script>
    <script src="https://wavedrom.com/wavedrom.min.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="[book] Causal inference in statistics a primer" href="Book-Causal_inference_in_statistics_a_primer.html" />
    <link rel="prev" title="[book] Analysis of Observational Health Care Data Using SAS" href="Book-Analysis%20of%20Observational%20Health%20Care%20Data%20Using%20SAS.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Study Notes</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Study Notes Index (knowledge base structure)
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Statistics
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Book-Analysis%20of%20Observational%20Health%20Care%20Data%20Using%20SAS.html">
   [book] Analysis of Observational Health Care Data Using SAS
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   [book] Causal Inference: What If
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Book-Causal_inference_in_statistics_a_primer.html">
   [book] Causal inference in statistics
   <em>
    a primer
   </em>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Book-Data_Analysis_Using_Regression_and_Multilevel_Hierarchical_Models.html">
   [book] Data Analysis Using Regression and Multilevel/Hierarchical Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Book-Fundamentals%20of%20Clinical%20Trials%20%284th%20edition%29.html">
   [book] Fundamentals of Clinical Trials (4th edition)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Book-Group%20Sequential%20and%20Confirmatory%20Adaptive%20Designs%20in%20Clinical%20Trials.html">
   [book] Group Sequential and Confirmatory Adaptive Designs in Clinical Trials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Book-Regression%20Modeling%20Strategies.html">
   [book] Regression Modeling Strategies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Adaptive%20Trial%20Design.html">
   Adaptive Clinical Trial Design
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Analysis%20of%20Ordinal%20Outcome.html">
   Analysis of ordinal outcome
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Analysis%20of%20Stratified%20Randomization%20Trial%20Data.html">
   Why analysis of stratified randomization trial data need to account for the stratification factors?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Association%20vs.%20Prediction%20vs.%20Causation.html">
   Association vs. Prediction vs. Causation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Baseline%20Adaptive%20Randomization.html">
   Baseline adaptive randomization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Bayesian%20optimization.html">
   Exploring Bayesian Optimization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Causal%20inference%20general.html">
   Causal Inference General Study Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Competing_Risk_Regression.html">
   Competing risk models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Correlated%20Data%20Analysis.html">
   Correlated/Longitudinal Data Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Cox_PH_model.html">
   ​Cox PH model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Dirichlet%20process.html">
   Dirichlet process
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-FDA%20guidances%20for%20industry.html">
   Notes on FDA Guidances for Industry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Gaussian%20process.html">
   Gaussain Process
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Group_Sequential_Trial_Design.html">
   Notes on Group Sequential Trial Design​
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-ICH%20guidelines.html">
   Notes on ICH guidelines​
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-MDD%20%26%20Effect%20size.html">
   Power,
   <strong>
    MDD
   </strong>
   /
   <strong>
    E
   </strong>
   (minimum detectable difference/effect), and
   <strong>
    Effect size
   </strong>
   in clinical trials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Meta-Analysis.html">
   Meta-analysis​
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Missing%20data.html">
   Missing data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Model%20comparison%20methods.html">
   Model comparison methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Monte%20Carlo%20method.html">
   Monte Carlo Method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Multicolinearity.html">
   Multicolinearity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Multiplicity%20in%20Clinical%20Trials.html">
   Multiplicity in Clinical Trials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Non-inferiority%20equivalence%20superiority%20test.html">
   Non-inferiority/equivalence/superiority test basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Observational%20study%20design.html">
   Observational study design
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Propensity%20score%20methods.html">
   Propensity Score Methods &amp; Implementation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Quantile%20regression.html">
   Quantile regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Sample_size_calculation_with_WMW_test.html">
   Sample size calculation for the Wilcoxon-Mann-Whitney test adjusting for ties
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Survival_Analysis.html">
   Survival Analysis
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Statistical computing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats_Comp/Note-How%20R%20searches%20and%20finds%20stuff.html">
   How R searches and finds stuff
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats_Comp/Note-Pandas.html">
   Pandas study note
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats_Comp/Note-R%20notes.html">
   R study notes/tips
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats_Comp/Note-googleVis.html">
   Google R package googleVis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats_Comp/Note-matplotlib.html">
   Notes on
   <code class="docutils literal notranslate">
    <span class="pre">
     matplotlib
    </span>
   </code>
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  DS/ML
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Book-Hands-On%20Machine%20Learning%20with%20Scikit-Learn%20and%20TensorFlow.html">
   [book] Hands-On Machine Learning with Scikit-Learn and TensorFlow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Book-Python%20Data%20Science%20Handbook.html">
   [book] Python Data Science Handbook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Course-Udemy-%20Python%20for%20Data%20Science%20and%20Machine%20Learning%20Bootcamp.html">
   Udemy: Python for Data Science and Machine Learning Bootcamp
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Note-Boosting.html">
   Boosting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Note-Cluster%20analysis.html">
   Cluster analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Note-Machine%20Learning%20%28General%29.html">
   ​Machine Learning (General)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Note-Naive%20Bayes.html">
   Naive Bayes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Note-Stochasitic%20Gradient%20Descent.html">
   Stochastic Gradient Decent (SGD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Note-Tree%2C%20Random%20Forest%20%28Bagging%29.html">
   Tree/Random Forest (Bagging)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Computer science
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../CS/Course-%E5%BB%96%E9%9B%AA%E5%B3%B0python%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0.html">
   廖雪峰python教程笔记
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../CS/Note-HTML%20basics.html">
   HTML Basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../CS/Note-Hard%20SQL%20interview%20questions.html">
   Hard Data Analyst SQL Interview Questions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../CS/Note-Inside%20look%20at%20modern%20web%20browser.html">
   Inside look at modern web browser
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../CS/Note-Learning%20React.html">
   Learning React
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../CS/Note-Learning%20Rust.html">
   Learning Rust
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../CS/Note-Modern%20JS%20explained.html">
   Modern JavaScript Explained
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../CS/Note-Python%20numpy.html">
   Numpy study notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../CS/Note-SQL%20Study%20Notes.html">
   SQL study notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../CS/Note-git%20and%20github.html">
   git and github
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Math
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Math/Course-Essence%20of%20linear%20algebra.html">
   Essence of linear algebra
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Miscellaneous
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Miscellaneous/Early%20managment%20of%20patients%20with%20AIS.html">
   Early management of patients with acute ischemic stroke
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Miscellaneous/Miscellaneous%20Notes.html">
   Miscellaneous Study Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Miscellaneous/Phamaceutical%20development.html">
   Pharmacedutical development
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Miscellaneous/Sim-Coin%20flip.html">
   :bulb: Q: fair coin, # of flips to get two consecutive side (H or T)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Miscellaneous/Sim-Generate%20random%20number%20between%201%20to%207.html">
   Generate random number 1 to 7 using a fair dice
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/askming/study_notes"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/askming/study_notes/issues/new?title=Issue%20on%20page%20%2FStats/Book-Causal Inference What If.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/Stats/Book-Causal Inference What If.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#chapter-2-randomized-experiments">
   Chapter 2 Randomized Experiments
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#randomization">
     2.1 Randomization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#conditional-randomization">
     2.2 Conditional randomization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#standardization">
     2.3 Standardization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inverse-probability-weighting-ipw">
     2.4 Inverse probability weighting (IPW)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#chapter-4-effect-modification">
   Chapter 4 Effect Modification
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>[book] Causal Inference: What If</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#chapter-2-randomized-experiments">
   Chapter 2 Randomized Experiments
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#randomization">
     2.1 Randomization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#conditional-randomization">
     2.2 Conditional randomization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#standardization">
     2.3 Standardization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inverse-probability-weighting-ipw">
     2.4 Inverse probability weighting (IPW)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#chapter-4-effect-modification">
   Chapter 4 Effect Modification
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="book-causal-inference-what-if">
<h1>[book] Causal Inference: What If<a class="headerlink" href="#book-causal-inference-what-if" title="Permalink to this headline">#</a></h1>
<p><em>by Miguel A. Hernan and James M. Robins</em></p>
<section id="chapter-2-randomized-experiments">
<h2>Chapter 2 Randomized Experiments<a class="headerlink" href="#chapter-2-randomized-experiments" title="Permalink to this headline">#</a></h2>
<section id="randomization">
<h3>2.1 Randomization<a class="headerlink" href="#randomization" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Counterfacatual: <span class="math notranslate nohighlight">\(Y^a\)</span> the “theoretical” outcome under certain treatment <span class="math notranslate nohighlight">\(a\)</span></p></li>
</ul>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>Note  <span class="math notranslate nohighlight">\(Y^a\perp\!\!\!\perp A\)</span> is different from  <span class="math notranslate nohighlight">\(Y\perp\!\!\!\perp A\)</span></p>
</aside>
<ul class="simple">
<li><p><strong>Exchangeability</strong> assumption: <span class="math notranslate nohighlight">\(Y^a\perp\!\!\!\perp A\)</span>, the counterfacatual is independent of actual treatment assigned; i.e. the counterfacatual is “fixed” no matter what treatment the subject receives. It can be observed if the actual treatment received is the same as the counterfactual treatment.</p></li>
<li><p><strong>Mean exchangeability</strong>: <span class="math notranslate nohighlight">\(E[Y^a|A=1] = E[Y^a|A=0] \text{ for all } a\)</span></p>
<ul>
<li><p>Exchangeability implies mean exchangeability, but not verse vasa (e.g. due to the difference in other distributional parameter, such as variance)</p></li>
<li><p>For dichotomous outcomes, exchangeability is equivalent to mean exchangeability</p></li>
</ul>
</li>
<li><p><mark>In ideal randomized experiments association is causation.</mark></p></li>
</ul>
</section>
<section id="conditional-randomization">
<h3>2.2 Conditional randomization<a class="headerlink" href="#conditional-randomization" title="Permalink to this headline">#</a></h3>
<ul>
<li><p><em>Conditionally randomized experiments</em> meaning there are several randomization probabilities that depend (are conditional) on the values of some variable(s) <span class="math notranslate nohighlight">\(L\)</span>.</p></li>
<li><p><em>Marginally randomized experiments</em> meaning there is only a single unconditional (marginal) randomization probability (doesn’t need to be 0.5) that is common to all individuals.</p>
<ul class="simple">
<li><p>a marginally randomized experiment is expected to result in exchangeability of the treated and the untreated:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
  Pr(Y^a=1|A=1) = Pr(Y^a=1|A=0) \text{ or } Y^a \perp\!\!\!\perp A \text{ for all } a
  \]</div>
</li>
</ul>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>This imbalance indicates that the risk of bad outcome in treated, had they remained untreated, would have been higher than that in the untreated.</p>
</aside>
<ul>
<li><p>In contrast, a conditionally randomized experiment will not generally result in exchangeability of the treated and the untreated because, by design, each group may have a different proportion of individuals with bad prognosis.</p></li>
<li><p>However, the conditional (or stratified) randomization can be considered as a combination of separate marginal randomiztions from each unique stratum defined by the randomization factors, within which the general rules of marginal randomization and causal inference apply, that is</p>
<div class="math notranslate nohighlight">
\[
  Pr[Y^a=1|A =1, L=l]=Pr[Y^a=1|A =0, L=l] \text{ or } Y^a \perp\!\!\!\perp A|L=l \text{ for all } a
  \]</div>
</li>
<li><p>To calculate the population average causal effect with conditional randomization, do the following two steps</p>
<ol class="simple">
<li><p>First, compute the average causal effect in each of these subsets or strata of the population</p></li>
<li><p>Second, compute the average causal effect by combining the individual effects from step 1</p>
<ul class="simple">
<li><p>Using <mark>standardization</mark> or <mark>inverse probability weighting</mark> (wich are mathmatically equivalent)</p></li>
</ul>
</li>
</ol>
</li>
</ul>
</section>
<section id="standardization">
<h3>2.3 Standardization<a class="headerlink" href="#standardization" title="Permalink to this headline">#</a></h3>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>Weighted average of the treatment effects from subgroups; weight is defined by the sample size of the subgorup</p>
</aside>
<ul>
<li><p>More formally, in <em>standardization</em>, the marginal counterfactual risk <span class="math notranslate nohighlight">\(Pr[Y^a=1]\)</span> is the weighted average of the stratum-specific risks <span class="math notranslate nohighlight">\(Pr[Y^a=1|L=0]\)</span> and <span class="math notranslate nohighlight">\(Pr[Y^a=1|L=1]\)</span> with weights equal to the proportion of individuals in the population with <span class="math notranslate nohighlight">\(L=0\)</span> and <span class="math notranslate nohighlight">\(L=1\)</span>, respectively.</p></li>
<li><p>Derivation of counterfactual risk by standardization</p>
<div class="math notranslate nohighlight">
\[
  Pr(Y^a=1) = \sum_l Pr(Y^a=1|L=l)Pr(L=l)
  \]</div>
<p>under conditoinal exchangeability, we can replace the (unobserved) counterfactual riks with the obsered risk:</p>
<div class="math notranslate nohighlight">
\[
  Pr(Y^a=1|L=l) = Pr(Y=1|A=a, L=l)
  \]</div>
<ul class="simple">
<li><p>When, as here, a counterfactual quantity can be expressed as function of the distribution (i.e., probabilities) of the observed data, we say that the counterfactual quantity is identified or identifiable; otherwise, we say it is unidentified or not identifiable.</p></li>
</ul>
</li>
</ul>
</section>
<section id="inverse-probability-weighting-ipw">
<h3>2.4 Inverse probability weighting (IPW)<a class="headerlink" href="#inverse-probability-weighting-ipw" title="Permalink to this headline">#</a></h3>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>The idea is that assuming all the patients in one subgroup receive treatment/control, and the outcome probability follows the obseved one from one of the arms (under conditional exchangeability assumption), how would the outcome look like (pseudo counterfactual).</p>
<p>Since the sample size in either arm is increased by N/ni folds (inverse of the proportion of patients in one of the arms), where N is the total sample size in this subgroup and ni is the sample size in one of the arms, the outcome from each invidividual should also be also upscaled by this ratio (N/n).</p>
</aside>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>IP weighted estimators were proposedbyHorvitzandThompson (1952) for surveys in which subjects are sampled with unequal probabilities</p>
</aside>
<ul>
<li><p>Under conditional exchangeability <span class="math notranslate nohighlight">\(Y^a \perp\!\!\!\perp A|L\)</span> in the original population, the treated and the untreated are (unconditionally) exchangeable in the pseudo-population because the <span class="math notranslate nohighlight">\(L\)</span> is independent of <span class="math notranslate nohighlight">\(A\)</span>.</p>
<ul class="simple">
<li><p>That is, the associational risk ratio in the pseudo-population is equal to the causal risk ratio in both the pseudo-population and the original population.</p></li>
</ul>
<p><img alt="sJRh3P_2022_06_22" src="https://cdn.jsdelivr.net/gh/askming/upic&#64;master/uPic/sJRh3P_2022_06_22.png" /></p>
</li>
<li><p>Informally, the pseudo-population is created by weighting each individual in the population by the inverse of the conditional probability of receiving the treatment level, IP weight:</p>
<div class="math notranslate nohighlight">
\[
  W^A = 1/f(A|L)
  \]</div>
</li>
<li><p>Standardization and IP weighting are mathematically equivalent</p>
<ul class="simple">
<li><p>In fact, both standardization and IP weighting can be viewed as procedures to build a new tree in which all individuals receive treatment <span class="math notranslate nohighlight">\(a\)</span>. Each method uses a different set of the probabilities to build the counterfactual tree: IP weighting uses the conditional probability of treatment <span class="math notranslate nohighlight">\(A\)</span> given the covariate <span class="math notranslate nohighlight">\(L\)</span> (as shown in Figure above), standardization uses the probability of the covariate <span class="math notranslate nohighlight">\(L\)</span> and the conditional probability of outcome <span class="math notranslate nohighlight">\(Y\)</span> given <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(L\)</span>.</p></li>
</ul>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>In a slight abuse of language we sometimes say that these methods <em>control</em> for <span class="math notranslate nohighlight">\(L\)</span>, but this “analytic control” is quite different from the “physical control” in a randomized experiment.
Standardization and IP weighting can be generalized to conditionally randomized studies with continuous outcomes</p>
</aside>
<ul class="simple">
<li><p>Because both standardization and IP weighting simulate what would have been observed if the variable (or variables in the vector) <span class="math notranslate nohighlight">\(L\)</span> had not been used to decide the probability of treatment, we often say that these methods <em><strong>adjust</strong></em> for <span class="math notranslate nohighlight">\(L\)</span>.</p></li>
</ul>
</li>
<li><p>Proof of the equivalence of IP weighting and standardization</p>
<ul>
<li><p>Standardized mean for treatment level <span class="math notranslate nohighlight">\(a\)</span> is defined as</p>
<div class="math notranslate nohighlight">
\[
    \sum_l E\left[Y|A=a, L=l\right]
    \]</div>
</li>
<li><p>IP weighted mean for the treatment level <span class="math notranslate nohighlight">\(a\)</span> is defined as</p>
<div class="math notranslate nohighlight">
\[
    E\left[\frac{I(A=a)Y}{f(A|L)}\right]
    \]</div>
<ul class="simple">
<li><p>proof of equivalence</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}
    E\left[\frac{I(A=a)Y}{f(A|L)}\right]  \\ 
    = \sum_l\frac{1}{f(a|l)}\{E\left[Y|A=a, L=l\right]f(a|l)Pr(L=l)\} \\
    =\sum_l E\left[Y|A=a, L=l\right]
    \end{split}\]</div>
</li>
</ul>
</li>
<li><p>It can be shown that both estimates of mean are euqal to the counterfactual mean <span class="math notranslate nohighlight">\(E[Y^a]\)</span> under the conditional exchangeability assumption, that is</p>
<div class="math notranslate nohighlight">
\[
  E[Y^a] = \sum_l E\left[Y|A=a, L=l\right] = E\left[\frac{I(A=a)Y}{f(A|L)}\right], \text{ under } Y\perp\!\!\!\perp A|L
  \]</div>
<ul class="simple">
<li><p>When treatment is continuous, which is an unlikely design choice in conditionally randomized experiments, <span class="math notranslate nohighlight">\(E[I(A=a)Y/f(A|L)]\)</span> is no longer equal to <span class="math notranslate nohighlight">\(\sum_l E\left[Y|A=a, L=l\right]\)</span> and thus is biased for <span class="math notranslate nohighlight">\(E[Y^a]\)</span> even under exchangeability</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="chapter-4-effect-modification">
<h2>Chapter 4 Effect Modification<a class="headerlink" href="#chapter-4-effect-modification" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>We say that <span class="math notranslate nohighlight">\(V\)</span> is a modifier of the effect of <span class="math notranslate nohighlight">\(A\)</span> on <span class="math notranslate nohighlight">\(Y\)</span> when the average causal effect of <span class="math notranslate nohighlight">\(A\)</span> on <span class="math notranslate nohighlight">\(Y\)</span> varies across levels of <span class="math notranslate nohighlight">\(V\)</span></p>
<ul>
<li><p>Since the average causal effect can be measured using different effect measures (e.g., risk difference, risk ratio), the presence of effect modification depends on the effect measure being used.</p></li>
<li><p><em>qualitative effect modification</em>: when the average causal effects in the subsets are in the opposite direction.</p></li>
</ul>
</li>
</ul>
<p><img alt="kyDpUe_2022_06_20" src="https://cdn.jsdelivr.net/gh/askming/upic&#64;master/uPic/kyDpUe_2022_06_20.png" /></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Stats"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>
    <script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="Book-Analysis%20of%20Observational%20Health%20Care%20Data%20Using%20SAS.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">[book] Analysis of Observational Health Care Data Using SAS</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="Book-Causal_inference_in_statistics_a_primer.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">[book] Causal inference in statistics <em>a primer</em></p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Ming Yang<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>