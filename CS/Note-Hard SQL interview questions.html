
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Hard Data Analyst SQL Interview Questions &#8212; Study Notes</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script src="https://wavedrom.com/skins/default.js"></script>
    <script src="https://wavedrom.com/wavedrom.min.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Inside look at modern web browser" href="Note-Inside%20look%20at%20modern%20web%20browser.html" />
    <link rel="prev" title="HTML Basics" href="Note-HTML%20basics.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Study Notes</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Study Notes Index (knowledge base structure)
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Statistics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Book-Analysis%20of%20Observational%20Health%20Care%20Data%20Using%20SAS.html">
   [book] Analysis of Observational Health Care Data Using SAS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Book-Causal%20Inference%20What%20If.html">
   [book] Causal Inference: What If
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Book-Causal_inference_in_statistics_a_primer.html">
   [book] Causal inference in statistics
   <em>
    a primer
   </em>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Book-Data_Analysis_Using_Regression_and_Multilevel_Hierarchical_Models.html">
   [book] Data Analysis Using Regression and Multilevel/Hierarchical Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Book-Fundamentals%20of%20Clinical%20Trials%20%284th%20edition%29.html">
   [book] Fundamentals of Clinical Trials (4th edition)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Book-Group%20Sequential%20and%20Confirmatory%20Adaptive%20Designs%20in%20Clinical%20Trials.html">
   [book] Group Sequential and Confirmatory Adaptive Designs in Clinical Trials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Book-Regression%20Modeling%20Strategies.html">
   [book] Regression Modeling Strategies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Adaptive%20Trial%20Design.html">
   Adaptive Clinical Trial Design
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Analysis%20of%20Ordinal%20Outcome.html">
   Analysis of ordinal outcome
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Analysis%20of%20Stratified%20Randomization%20Trial%20Data.html">
   Why analysis of stratified randomization trial data need to account for the stratification factors?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Association%20vs.%20Prediction%20vs.%20Causation.html">
   Association vs. Prediction vs. Causation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Baseline%20Adaptive%20Randomization.html">
   Baseline adaptive randomization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Bayesian%20optimization.html">
   Exploring Bayesian Optimization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Causal%20inference%20general.html">
   Causal Inference General Study Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Competing_Risk_Regression.html">
   Competing risk models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Correlated%20Data%20Analysis.html">
   Correlated/Longitudinal Data Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Cox_PH_model.html">
   ​Cox PH model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Dirichlet%20process.html">
   Dirichlet process
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-FDA%20guidances%20for%20industry.html">
   Notes on FDA Guidances for Industry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Gaussian%20process.html">
   Gaussain Process
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Group_Sequential_Trial_Design.html">
   Notes on Group Sequential Trial Design​
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-ICH%20guidelines.html">
   Notes on ICH guidelines​
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-MDD%20%26%20Effect%20size.html">
   Power,
   <strong>
    MDD
   </strong>
   /
   <strong>
    E
   </strong>
   (minimum detectable difference/effect), and
   <strong>
    Effect size
   </strong>
   in clinical trials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Meta-Analysis.html">
   Meta-analysis​
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Missing%20data.html">
   Missing data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Model%20comparison%20methods.html">
   Model comparison methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Monte%20Carlo%20method.html">
   Monte Carlo Method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Multicolinearity.html">
   Multicolinearity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Multiplicity%20in%20Clinical%20Trials.html">
   Multiplicity in Clinical Trials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Non-inferiority%20equivalence%20superiority%20test.html">
   Non-inferiority/equivalence/superiority test basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Observational%20study%20design.html">
   Observational study design
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Propensity%20score%20methods.html">
   Propensity Score Methods &amp; Implementation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Quantile%20regression.html">
   Quantile regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Sample_size_calculation_with_WMW_test.html">
   Sample size calculation for the Wilcoxon-Mann-Whitney test adjusting for ties
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Survival_Analysis.html">
   Survival Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/%C2%A0Note-Trimmed%20means%20analysis.html">
   Trimmed means analysis
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Statistical computing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats_Comp/Note-How%20R%20searches%20and%20finds%20stuff.html">
   How R searches and finds stuff
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats_Comp/Note-Pandas.html">
   Pandas study note
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats_Comp/Note-R%20notes.html">
   R study notes/tips
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats_Comp/Note-googleVis.html">
   Google R package googleVis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats_Comp/Note-matplotlib.html">
   Notes on
   <code class="docutils literal notranslate">
    <span class="pre">
     matplotlib
    </span>
   </code>
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  DS/ML
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Book-Hands-On%20Machine%20Learning%20with%20Scikit-Learn%20and%20TensorFlow.html">
   [book] Hands-On Machine Learning with Scikit-Learn and TensorFlow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Book-Python%20Data%20Science%20Handbook.html">
   [book] Python Data Science Handbook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Course-Udemy-%20Python%20for%20Data%20Science%20and%20Machine%20Learning%20Bootcamp.html">
   Udemy: Python for Data Science and Machine Learning Bootcamp
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Note-Boosting.html">
   Boosting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Note-Cluster%20analysis.html">
   Cluster analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Note-Machine%20Learning%20%28General%29.html">
   ​Machine Learning (General)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Note-Naive%20Bayes.html">
   Naive Bayes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Note-Stochasitic%20Gradient%20Descent.html">
   Stochastic Gradient Decent (SGD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Note-Tree%2C%20Random%20Forest%20%28Bagging%29.html">
   Tree/Random Forest (Bagging)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Computer science
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Course-%E5%BB%96%E9%9B%AA%E5%B3%B0python%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0.html">
   廖雪峰python教程笔记
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-HTML%20basics.html">
   HTML Basics
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Hard Data Analyst SQL Interview Questions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Inside%20look%20at%20modern%20web%20browser.html">
   Inside look at modern web browser
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Learning%20React.html">
   Learning React
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Learning%20Rust.html">
   Learning Rust
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Modern%20JS%20explained.html">
   Modern JavaScript Explained
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-Python%20numpy.html">
   Numpy study notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-SQL%20Study%20Notes.html">
   SQL study notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Note-git%20and%20github.html">
   git and github
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Math
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Math/Course-Essence%20of%20linear%20algebra.html">
   Essence of linear algebra
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Miscellaneous
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Miscellaneous/Early%20managment%20of%20patients%20with%20AIS.html">
   Early management of patients with acute ischemic stroke
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Miscellaneous/Miscellaneous%20Notes.html">
   Miscellaneous Study Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Miscellaneous/Phamaceutical%20development.html">
   Pharmacedutical development
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Miscellaneous/Sim-Coin%20flip.html">
   :bulb: Q: fair coin, # of flips to get two consecutive side (H or T)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Miscellaneous/Sim-Generate%20random%20number%20between%201%20to%207.html">
   Generate random number 1 to 7 using a fair dice
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/askming/study_notes"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/askming/study_notes/issues/new?title=Issue%20on%20page%20%2FCS/Note-Hard SQL interview questions.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/CS/Note-Hard SQL interview questions.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#background-motivation">
   Background &amp; Motivation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#assumptions-how-to-use-this-guide">
   Assumptions &amp; How to use this guide
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tips-on-solving-difficult-sql-interview-questions">
   Tips on solving difficult SQL interview questions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#self-join-practice-problems">
   Self-Join Practice Problems
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mom-percent-change">
     1: MoM Percent Change
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tree-structure-labeling">
     2: Tree Structure Labeling
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#retained-users-per-month-multi-part">
     3: Retained Users Per Month (multi-part)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#part-1">
     Part 1:
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#part-2">
       Part 2:
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#part-3">
       Part 3:
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cumulative-sums">
     4: Cumulative Sums
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rolling-averages">
     5: Rolling Averages
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-join-conditions">
     6: Multiple Join Conditions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#window-function-practice-problems">
   Window Function Practice Problems
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#get-the-id-with-the-highest-value">
     1: Get the ID with the highest value
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#average-and-rank-with-a-window-function-multi-part">
     2: Average and rank with a window function (multi-part)
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Part 1:
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Part 2:
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#other-medium-hard-sql-practice-problems">
   Other Medium/Hard SQL Practice Problems
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#histograms">
     1: Histograms
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cross-join-multi-part">
     2: CROSS JOIN (multi-part)
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id3">
       Part 1:
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id4">
       Part 2:
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#advancing-counting">
     3: Advancing Counting
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#acknowledgments-and-additional-resources">
   Acknowledgments and Additional Resources
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Hard Data Analyst SQL Interview Questions</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#background-motivation">
   Background &amp; Motivation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#assumptions-how-to-use-this-guide">
   Assumptions &amp; How to use this guide
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tips-on-solving-difficult-sql-interview-questions">
   Tips on solving difficult SQL interview questions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#self-join-practice-problems">
   Self-Join Practice Problems
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mom-percent-change">
     1: MoM Percent Change
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tree-structure-labeling">
     2: Tree Structure Labeling
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#retained-users-per-month-multi-part">
     3: Retained Users Per Month (multi-part)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#part-1">
     Part 1:
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#part-2">
       Part 2:
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#part-3">
       Part 3:
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cumulative-sums">
     4: Cumulative Sums
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rolling-averages">
     5: Rolling Averages
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-join-conditions">
     6: Multiple Join Conditions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#window-function-practice-problems">
   Window Function Practice Problems
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#get-the-id-with-the-highest-value">
     1: Get the ID with the highest value
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#average-and-rank-with-a-window-function-multi-part">
     2: Average and rank with a window function (multi-part)
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Part 1:
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Part 2:
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#other-medium-hard-sql-practice-problems">
   Other Medium/Hard SQL Practice Problems
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#histograms">
     1: Histograms
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cross-join-multi-part">
     2: CROSS JOIN (multi-part)
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id3">
       Part 1:
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id4">
       Part 2:
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#advancing-counting">
     3: Advancing Counting
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#acknowledgments-and-additional-resources">
   Acknowledgments and Additional Resources
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="hard-data-analyst-sql-interview-questions">
<h1><a class="reference external" href="https://quip.com/2gwZArKuWk7W">Hard Data Analyst SQL Interview Questions</a><a class="headerlink" href="#hard-data-analyst-sql-interview-questions" title="Permalink to this headline">#</a></h1>
<p>By Zachary Thomas</p>
<p><strong>Update:</strong> Thanks everyone for the support and feedback! See this discussion on this post on <a class="reference external" href="https://news.ycombinator.com/item?id=23053981">Hacker News</a>, <a class="reference external" href="https://www.linkedin.com/posts/thomaszi_the-best-medium-hard-data-analyst-sql-interview-activity-6662828341382516736-L5If">Linkedin</a>, Eric Weber’s <a class="reference external" href="https://www.linkedin.com/posts/eric-weber-060397b7_datascience-analytics-sql-activity-6663082042990952449-wuOK">Linkedin post</a></p>
<section id="background-motivation">
<h2>Background &amp; Motivation<a class="headerlink" href="#background-motivation" title="Permalink to this headline">#</a></h2>
<blockquote>
<div><p>The first 70% of SQL is pretty straightforward but the remaining 30% can be pretty tricky.</p>
</div></blockquote>
<p>There are plenty of great beginner SQL guides out there. My favorites are Codecademy’s <a class="reference external" href="https://www.codecademy.com/learn/learn-sql">interactive SQL courses</a> and Zi Chong Kao’s <a class="reference external" href="https://selectstarsql.com/">Select Star SQL</a>. However, like I told a friend, while the first 70% of SQL is pretty straightforward, the remaining 30% can be pretty tricky. Data analyst and data scientist interview questions at technology companies often pull from that 30%.</p>
<p>Working through this guide should improve your performance on data analyst interviews. It should also make you better at your current and future job positions. Personally, I find some of the SQL patterns found in this doc useful for ETLs powering reporting tools featuring trends over time.</p>
<p>To be clear, data analyst and data scientist interviews consist of more than SQL questions. Other common topics include explaining past projects, A/B testing (I like <a class="reference external" href="https://www.udacity.com/course/ab-testing--ud257">Udacity’s course</a> on the subject), metric development and open-ended analytical problems. This <a class="reference external" href="https://qr.ae/pNrdGV">Quora answer</a> has Facebook’s product analyst interview guide circa 2017, which discusses this topic in more depth. That said, if improving your SQL skills can make your interviews less stressful than they already are, it could very well be worth your time.</p>
</section>
<section id="assumptions-how-to-use-this-guide">
<h2>Assumptions &amp; How to use this guide<a class="headerlink" href="#assumptions-how-to-use-this-guide" title="Permalink to this headline">#</a></h2>
<p><strong>Assumptions about SQL proficiency:</strong> This guide assumes you have a working knowledge of SQL. You probably use it frequently at work already but want to sharpen your skills on topics like self-joins and window functions.</p>
<p><strong>How to use this guide:</strong> Since interviews usually utilize a whiteboard or a virtual (non-compiling) notepad, my recommendation is to get out a pencil and paper and write out your solutions to each part of the problem, and once complete compare your answers to the answer key. Or, complete these with a friend who can act as the interviewer!</p>
<ul class="simple">
<li><p>Small SQL syntax errors aren’t a big deal during whiteboard/notepad interviews. However, they can be distracting to the interviewer, so ideally practice reducing these so your logic shines through in the interview.</p></li>
<li><p>The answers I provide may not be the only way to successfully solve the question. Feel free to message with additional solutions and I can add them to this guide!</p></li>
</ul>
</section>
<section id="tips-on-solving-difficult-sql-interview-questions">
<h2>Tips on solving difficult SQL interview questions<a class="headerlink" href="#tips-on-solving-difficult-sql-interview-questions" title="Permalink to this headline">#</a></h2>
<p>This advice mirrors typical code interview advice …</p>
<ol>
<li><p>Listen carefully to problem description, repeat back the crux of the problem to the interviewer</p></li>
<li><p>Spell out an edge case to demonstrate you actually understand problem (i.e. a row that <em>wouldn’t</em> be included in the output of the SQL you are about to sketch out)</p></li>
<li><p>(If the problem involves a self-join) For your own benefit sketch out what the self-join will look like — this will typically be at least three columns: a column of interest from the main table, the column to join from the main table, and the column to join from the secondary table</p>
<p>i. Or, as you get more used to self-join problems, you can explain this step verbally</p>
</li>
<li><p>Start writing SQL — err towards writing SQL versus trying to perfectly understand the problem. Verbalize your assumptions as you go so your interviewer can correct you if you go astray.</p></li>
</ol>
</section>
<section id="self-join-practice-problems">
<h2>Self-Join Practice Problems<a class="headerlink" href="#self-join-practice-problems" title="Permalink to this headline">#</a></h2>
<section id="mom-percent-change">
<h3>1: MoM Percent Change<a class="headerlink" href="#mom-percent-change" title="Permalink to this headline">#</a></h3>
<p><strong>Context:</strong> Oftentimes it’s useful to know how much a key metric, such as monthly active users, changes between months. Say we have a table <code class="docutils literal notranslate"><span class="pre">logins</span></code> in the form:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>user_id</p></th>
<th class="head"><p>date</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>2018-07-01</p></td>
</tr>
<tr class="row-odd"><td><p>234</p></td>
<td><p>2018-07-02</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>2018-07-02</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>2018-07-02</p></td>
</tr>
<tr class="row-even"><td><p>…</p></td>
<td><p>…</p></td>
</tr>
<tr class="row-odd"><td><p>234</p></td>
<td><p>2018-10-04</p></td>
</tr>
</tbody>
</table>
<p><strong>Task</strong>: Find the month-over-month percentage change for monthly active users (MAU).</p>
<hr class="docutils" />
<p><em><strong>Solution:</strong></em></p>
<p><em>(This solution, like other solution code blocks you will see in this doc, contains comments about SQL syntax that may differ between flavors of SQL or other comments about the solutions as listed)</em></p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span><span class="w"> </span><span class="n">mau</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span>
<span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">   </span><span class="cm">/* </span>
<span class="cm">    * Typically, interviewers allow you to write psuedocode for date functions </span>
<span class="cm">    * i.e. will NOT be checking if you have memorized date functions. </span>
<span class="cm">    * Just explain what your function does as you whiteboard </span>
<span class="cm">    *</span>
<span class="cm">    * DATE_TRUNC() is available in Postgres, but other SQL date functions or </span>
<span class="cm">    * combinations of date functions can give you a identical results   </span>
<span class="cm">    * See https://www.postgresql.org/docs/9.0/functions-datetime.html#FUNCTIONS-DATETIME-TRUNC</span>
<span class="cm">    */</span><span class="w"> </span>
<span class="w">    </span><span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">date</span><span class="p">)</span><span class="w"> </span><span class="n">month_timestamp</span><span class="p">,</span>
<span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="n">mau</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span>
<span class="w">    </span><span class="n">logins</span><span class="w"> </span>
<span class="w">  </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
<span class="w">    </span><span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">date</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span>
<span class="w"> </span>
<span class="w"> </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="cm">/*</span>
<span class="cm">    * You don&#39;t literally need to include the previous month in this SELECT statement. </span>
<span class="cm">    * </span>
<span class="cm">    * However, as mentioned in the &quot;Tips&quot; section of this guide, it can be helpful </span>
<span class="cm">    * to at least sketch out self-joins to avoid getting confused which table </span>
<span class="cm">    * represents the prior month vs current month, etc. </span>
<span class="cm">    */</span><span class="w"> </span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="n">month_timestamp</span><span class="w"> </span><span class="n">previous_month</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="n">mau</span><span class="w"> </span><span class="n">previous_mau</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">b</span><span class="p">.</span><span class="n">month_timestamp</span><span class="w"> </span><span class="n">current_month</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">b</span><span class="p">.</span><span class="n">mau</span><span class="w"> </span><span class="n">current_mau</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">ROUND</span><span class="p">(</span><span class="mi">100</span><span class="p">.</span><span class="mi">0</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">mau</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">mau</span><span class="p">)</span><span class="o">/</span><span class="n">a</span><span class="p">.</span><span class="n">mau</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">percent_change</span><span class="w"> </span>
<span class="w"> </span><span class="k">FROM</span>
<span class="w">    </span><span class="n">mau</span><span class="w"> </span><span class="n">a</span><span class="w"> </span>
<span class="w"> </span><span class="k">JOIN</span><span class="w"> </span>
<span class="w">    </span><span class="cm">/*</span>
<span class="cm">    * Could also have done `ON b.month_timestamp = a.month_timestamp + interval &#39;1 month&#39;` </span>
<span class="cm">    */</span>
<span class="w">    </span><span class="n">mau</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">month_timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">month_timestamp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">interval</span><span class="w"> </span><span class="s1">&#39;1 month&#39;</span><span class="w"> </span>
<span class="w">  </span>
</pre></div>
</div>
</section>
<section id="tree-structure-labeling">
<h3>2: Tree Structure Labeling<a class="headerlink" href="#tree-structure-labeling" title="Permalink to this headline">#</a></h3>
<p><strong>Context:</strong> Say you have a table <code class="docutils literal notranslate"><span class="pre">tree</span></code> with a column of nodes and a column corresponding parent nodes</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>node</p></th>
<th class="head"><p>parent</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>NULL</p></td>
</tr>
</tbody>
</table>
<p><strong>Task:</strong> Write SQL such that we label each node as a “leaf”, “inner” or “Root” node, such that for the nodes above we get:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>node</p></th>
<th class="head"><p>label</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Leaf</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Inner</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>Inner</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>Leaf</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>Root</p></td>
</tr>
</tbody>
</table>
<p>A solution which works for the above example will receive full credit, although you can receive extra credit for providing a solution that is generalizable to a tree of any depth (not just depth = 2, as is the case in the example above).</p>
<p>(Side note: <a class="reference external" href="http://ceadserv1.nku.edu/longa//classes/mat385_resources/docs/trees.html">this link</a> has more details on Tree data structure terminology. Not needed to solve the problem though!)</p>
<hr class="docutils" />
<p><em><strong>Solution:</strong></em></p>
<p><strong>Note:</strong> This solution works for the example above with tree depth = 2, but is not generalizable beyond that.</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span><span class="w"> </span><span class="n">join_table</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span>
<span class="p">(</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="n">node</span><span class="w"> </span><span class="n">a_node</span><span class="p">,</span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="n">a_parent</span><span class="p">,</span>
<span class="w">    </span><span class="n">b</span><span class="p">.</span><span class="n">node</span><span class="w"> </span><span class="n">b_node</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">b</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="n">b_parent</span>
<span class="w"> </span><span class="k">FROM</span>
<span class="w">    </span><span class="n">tree</span><span class="w"> </span><span class="n">a</span><span class="w"> </span>
<span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span>
<span class="w">    </span><span class="n">tree</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">node</span><span class="w"> </span>
<span class="w"> </span><span class="p">)</span>
<span class="w"> </span>
<span class="w"> </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">a_node</span><span class="w"> </span><span class="n">node</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="k">CASE</span><span class="w"> </span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">b_node</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">b_parent</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Root&#39;</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">b_node</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">b_parent</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Leaf&#39;</span><span class="w">        </span>
<span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;Inner&#39;</span><span class="w"> </span>
<span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">label</span><span class="w"> </span>
<span class="w"> </span><span class="k">FROM</span><span class="w"> </span>
<span class="w">    </span><span class="n">join_table</span><span class="w"> </span>
<span class="w">        </span>
</pre></div>
</div>
<p>An alternate solution, that is generalizable to any tree depth:</p>
<p><strong>Acknowledgement:</strong> this more generalizable solution was contributed by Fabian Hofmann on 5/2/20. Thank, FH!</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span><span class="w"> </span><span class="n">join_table</span><span class="w"> </span><span class="k">AS</span>
<span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="n">cur</span><span class="p">.</span><span class="n">node</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">cur</span><span class="p">.</span><span class="n">parent</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="k">COUNT</span><span class="p">(</span><span class="k">next</span><span class="p">.</span><span class="n">node</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">num_children</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span>
<span class="w">        </span><span class="n">tree</span><span class="w"> </span><span class="n">cur</span>
<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span>
<span class="w">        </span><span class="n">tree</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="p">(</span><span class="k">next</span><span class="p">.</span><span class="n">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cur</span><span class="p">.</span><span class="n">node</span><span class="p">)</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
<span class="w">        </span><span class="n">cur</span><span class="p">.</span><span class="n">node</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">cur</span><span class="p">.</span><span class="n">parent</span>
<span class="p">)</span>

<span class="k">SELECT</span>
<span class="w">    </span><span class="n">node</span><span class="p">,</span>
<span class="w">    </span><span class="k">CASE</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">parent</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="ss">&quot;Root&quot;</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">num_children</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="ss">&quot;Leaf&quot;</span>
<span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="ss">&quot;Inner&quot;</span>
<span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">label</span>
<span class="k">FROM</span><span class="w"> </span>
<span class="w">    </span><span class="n">join_table</span><span class="w"> </span>
</pre></div>
</div>
<p>An alternate solution, without explicit joins:</p>
<p><strong>Acknowledgement:</strong> William Chargin on 5/2/20 noted that <code class="docutils literal notranslate"><span class="pre">WHERE</span> <span class="pre">parent</span> <span class="pre">IS</span> <span class="pre">NOT</span> <span class="pre">NULL</span></code>  is needed to make this solution return <code class="docutils literal notranslate"><span class="pre">Leaf</span></code> instead of <code class="docutils literal notranslate"><span class="pre">NULL</span></code>. Thanks, WC!</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">node</span><span class="p">,</span>
<span class="w">    </span><span class="k">CASE</span><span class="w"> </span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">parent</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Root&#39;</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span>
<span class="w">            </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">parent</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">parent</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">)</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Leaf&#39;</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">parent</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tree</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">parent</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;Inner&#39;</span>
<span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">label</span><span class="w"> </span>
<span class="w"> </span><span class="k">from</span><span class="w"> </span>
<span class="w">    </span><span class="n">tree</span>
</pre></div>
</div>
</section>
<section id="retained-users-per-month-multi-part">
<h3>3: Retained Users Per Month (multi-part)<a class="headerlink" href="#retained-users-per-month-multi-part" title="Permalink to this headline">#</a></h3>
<p><strong>Acknowledgement:</strong> this problem is adapted from SiSense’s <a class="reference external" href="https://www.sisense.com/blog/use-self-joins-to-calculate-your-retention-churn-and-reactivation-metrics/">“Using Self Joins to Calculate Your Retention, Churn, and Reactivation Metrics”</a> blog post</p>
</section>
<section id="part-1">
<h3>Part 1:<a class="headerlink" href="#part-1" title="Permalink to this headline">#</a></h3>
<p><strong>Context:</strong> Say we have login data in the table <code class="docutils literal notranslate"><span class="pre">logins</span></code>:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>user_id</p></th>
<th class="head"><p>date</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>2018-07-01</p></td>
</tr>
<tr class="row-odd"><td><p>234</p></td>
<td><p>2018-07-02</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>2018-07-02</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>2018-07-02</p></td>
</tr>
<tr class="row-even"><td><p>…</p></td>
<td><p>…</p></td>
</tr>
<tr class="row-odd"><td><p>234</p></td>
<td><p>2018-10-04</p></td>
</tr>
</tbody>
</table>
<p><strong>Task:</strong> Write a query that gets the number of retained users per month. In this case, retention for a given month is defined as the number of users who logged in that month who also logged in the immediately previous month.</p>
<hr class="docutils" />
<p><em><strong>Solution:</strong></em></p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="nb">date</span><span class="p">)</span><span class="w"> </span><span class="n">month_timestamp</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="n">retained_users</span><span class="w"> </span>
<span class="w"> </span><span class="k">FROM</span><span class="w"> </span>
<span class="w">    </span><span class="n">logins</span><span class="w"> </span><span class="n">a</span><span class="w"> </span>
<span class="w"> </span><span class="k">JOIN</span><span class="w"> </span>
<span class="w">    </span><span class="n">logins</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span>
<span class="w">        </span><span class="k">AND</span><span class="w"> </span><span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="nb">date</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="nb">date</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                                             </span><span class="nb">interval</span><span class="w"> </span><span class="s1">&#39;1 month&#39;</span>
<span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
<span class="w">    </span><span class="n">date_trunc</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="nb">date</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Acknowledgement:</strong> Tom Moertel pointed out de-duping user-login pairs before the self-join would make the solution more efficient and contributed the alternate solution below. Thanks, TM!</p>
<p><strong>Note:</strong> De-duping <code class="docutils literal notranslate"><span class="pre">logins</span></code> would also make the given solutions to Parts 2 and 3 of this problem more efficient as well.</p>
<p>Alternate solution:</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span><span class="w"> </span><span class="n">DistinctMonthlyUsers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="cm">/*</span>
<span class="cm">  * For each month, compute the *set* of users having logins.</span>
<span class="cm">  */</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span>
<span class="w">      </span><span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">&#39;MONTH&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">date</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">month_timestamp</span><span class="p">,</span>
<span class="w">      </span><span class="n">user_id</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">logins</span>
<span class="w">  </span><span class="p">)</span>

<span class="k">SELECT</span>
<span class="w">  </span><span class="n">CurrentMonth</span><span class="p">.</span><span class="n">month_timestamp</span><span class="w"> </span><span class="n">month_timestamp</span><span class="p">,</span>
<span class="w">  </span><span class="k">COUNT</span><span class="p">(</span><span class="n">PriorMonth</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">retained_user_count</span>
<span class="k">FROM</span><span class="w"> </span>
<span class="w">    </span><span class="n">DistinctMonthlyUsers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">CurrentMonth</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span>
<span class="w">    </span><span class="n">DistinctMonthlyUsers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">PriorMonth</span>
<span class="w">  </span><span class="k">ON</span>
<span class="w">    </span><span class="n">CurrentMonth</span><span class="p">.</span><span class="n">month_timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PriorMonth</span><span class="p">.</span><span class="n">month_timestamp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;1 MONTH&#39;</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span>
<span class="w">    </span><span class="n">CurrentMonth</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PriorMonth</span><span class="p">.</span><span class="n">user_id</span>
</pre></div>
</div>
<section id="part-2">
<h4>Part 2:<a class="headerlink" href="#part-2" title="Permalink to this headline">#</a></h4>
<p><strong>Task:</strong> Now we’ll take retention and turn it on its head: Write a query to find many users last month <em>did not</em> come back this month. i.e. the number of churned users.</p>
<hr class="docutils" />
<p><em><strong>Solution:</strong></em></p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="nb">date</span><span class="p">)</span><span class="w"> </span><span class="n">month_timestamp</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="n">churned_users</span><span class="w"> </span>
<span class="k">FROM</span><span class="w"> </span>
<span class="w">    </span><span class="n">logins</span><span class="w"> </span><span class="n">a</span><span class="w"> </span>
<span class="k">FULL</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span>
<span class="w">    </span><span class="n">logins</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span>
<span class="w">        </span><span class="k">AND</span><span class="w"> </span><span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="nb">date</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="nb">date</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                                         </span><span class="nb">interval</span><span class="w"> </span><span class="s1">&#39;1 month&#39;</span>
<span class="k">WHERE</span><span class="w"> </span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
<span class="w">    </span><span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="nb">date</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that there are solutions to this problem that can use <code class="docutils literal notranslate"><span class="pre">LEFT</span></code> or <code class="docutils literal notranslate"><span class="pre">RIGHT</span></code> joins.</p>
</section>
<section id="part-3">
<h4>Part 3:<a class="headerlink" href="#part-3" title="Permalink to this headline">#</a></h4>
<p><strong>Context</strong>: You now want to see the number of active users this month <em>who have been reactivated</em> — in other words, users who have churned but this month they became active again. Keep in mind a user can reactivate after churning <em>before</em> the previous month. An example of this could be a user active in February (appears in <code class="docutils literal notranslate"><span class="pre">logins</span></code>), no activity in March and April, but then active again in May (appears in <code class="docutils literal notranslate"><span class="pre">logins</span></code>), so they count as a reactivated user for May .</p>
<p><strong>Task:</strong> Create a table that contains the number of reactivated users per month.</p>
<hr class="docutils" />
<p><em><strong>Solution:</strong></em></p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="w">     </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="nb">date</span><span class="p">)</span><span class="w"> </span><span class="n">month_timestamp</span><span class="p">,</span>
<span class="w">        </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="n">reactivated_users</span><span class="p">,</span>
<span class="w">        </span><span class="cm">/* </span>
<span class="cm">        * At least in the flavors of SQL I have used, you don&#39;t need to </span>
<span class="cm">        * include the columns used in HAVING in the SELECT statement.</span>
<span class="cm">        * I have written them out for clarity here.  </span>
<span class="cm">        */</span><span class="w"> </span>
<span class="w">        </span><span class="k">MAX</span><span class="p">(</span><span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="nb">date</span><span class="p">))</span><span class="w"> </span><span class="n">most_recent_active_previously</span><span class="w"> </span>
<span class="w">     </span><span class="k">FROM</span><span class="w"> </span>
<span class="w">        </span><span class="n">logins</span><span class="w"> </span><span class="n">a</span>
<span class="w">     </span><span class="k">JOIN</span>
<span class="w">        </span><span class="n">logins</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span>
<span class="w">                </span><span class="k">AND</span><span class="w"> </span>
<span class="w">                </span><span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="nb">date</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="nb">date</span><span class="p">)</span>
<span class="w">     </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
<span class="w">        </span><span class="n">DATE_TRUNC</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="nb">date</span><span class="p">)</span>
<span class="w">     </span><span class="k">HAVING</span><span class="w"> </span>
<span class="w">        </span><span class="n">month_timestamp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">most_recent_active_previously</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">interval</span><span class="w"> </span><span class="s1">&#39;1 month&#39;</span><span class="w"> </span>
</pre></div>
</div>
</section>
</section>
<section id="cumulative-sums">
<h3>4: Cumulative Sums<a class="headerlink" href="#cumulative-sums" title="Permalink to this headline">#</a></h3>
<p><strong>Acknowledgement:</strong> This problem was inspired by Sisense’s<a class="reference external" href="https://www.sisense.com/blog/cash-flow-modeling-in-sql/">“Cash Flow modeling in SQL”</a> blog post</p>
<p><strong>Context:</strong> Say we have a table <code class="docutils literal notranslate"><span class="pre">transactions</span></code> in the form:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>date</p></th>
<th class="head"><p>cash_flow</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>2018-01-01</p></td>
<td><p>-1000</p></td>
</tr>
<tr class="row-odd"><td><p>2018-01-02</p></td>
<td><p>-100</p></td>
</tr>
<tr class="row-even"><td><p>2018-01-03</p></td>
<td><p>50</p></td>
</tr>
<tr class="row-odd"><td><p>…</p></td>
<td><p>…</p></td>
</tr>
</tbody>
</table>
<p>Where <code class="docutils literal notranslate"><span class="pre">cash_flow</span></code> is the revenues minus costs for each day.</p>
<p><strong>Task:</strong> Write a query to get <em>cumulative</em> cash flow for each day such that we end up with a table in the form below:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>date</p></th>
<th class="head"><p>cumulative_cf</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>2018-01-01</p></td>
<td><p>-1000</p></td>
</tr>
<tr class="row-odd"><td><p>2018-01-02</p></td>
<td><p>-1100</p></td>
</tr>
<tr class="row-even"><td><p>2018-01-03</p></td>
<td><p>-1050</p></td>
</tr>
<tr class="row-odd"><td><p>…</p></td>
<td><p>…</p></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
<p><em><strong>Solution:</strong></em></p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="nb">date</span><span class="w"> </span><span class="nb">date</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">cash_flow</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cumulative_cf</span><span class="w"> </span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">transactions</span><span class="w"> </span><span class="n">a</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">b</span><span class="w"> </span>
<span class="w">    </span><span class="n">transactions</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="nb">date</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="nb">date</span><span class="w"> </span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="nb">date</span><span class="w"> </span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
<span class="w">    </span><span class="nb">date</span><span class="w"> </span><span class="k">ASC</span>
</pre></div>
</div>
<p>Alternate solution using a window function (more efficient!):</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="nb">date</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">cash_flow</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="nb">date</span><span class="w"> </span><span class="k">ASC</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cumulative_cf</span><span class="w"> </span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">transactions</span><span class="w"> </span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
<span class="w">    </span><span class="nb">date</span><span class="w"> </span><span class="k">ASC</span>
</pre></div>
</div>
</section>
<section id="rolling-averages">
<h3>5: Rolling Averages<a class="headerlink" href="#rolling-averages" title="Permalink to this headline">#</a></h3>
<p><strong>Acknowledgement:</strong> This problem is adapted from Sisense’s <a class="reference external" href="https://www.sisense.com/blog/rolling-average/">“Rolling Averages in MySQL and SQL Server”</a> blog post</p>
<p><strong>Note:</strong> there are different ways to compute rolling/moving averages. Here we’ll use a preceding average which means that the metric for the 7th day of the month would be the average of the preceding 6 days and that day itself.</p>
<p><strong>Context</strong>: Say we have table <code class="docutils literal notranslate"><span class="pre">signups</span></code> in the form:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>date</p></th>
<th class="head"><p>sign_ups</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>2018-01-01</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-odd"><td><p>2018-01-02</p></td>
<td><p>20</p></td>
</tr>
<tr class="row-even"><td><p>2018-01-03</p></td>
<td><p>50</p></td>
</tr>
<tr class="row-odd"><td><p>…</p></td>
<td><p>…</p></td>
</tr>
<tr class="row-even"><td><p>2018-10-01</p></td>
<td><p>35</p></td>
</tr>
</tbody>
</table>
<p><strong>Task</strong>: Write a query to get 7-day rolling (preceding) average of daily sign ups.</p>
<hr class="docutils" />
<p><em><strong>Solution:</strong></em></p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">  </span><span class="n">a</span><span class="p">.</span><span class="nb">date</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="k">AVG</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">sign_ups</span><span class="p">)</span><span class="w"> </span><span class="n">average_sign_ups</span><span class="w"> </span>
<span class="k">FROM</span><span class="w"> </span>
<span class="w">  </span><span class="n">signups</span><span class="w"> </span><span class="n">a</span><span class="w"> </span>
<span class="k">JOIN</span><span class="w"> </span>
<span class="w">  </span><span class="n">signups</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="nb">date</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="nb">date</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">interval</span><span class="w"> </span><span class="s1">&#39;6 days&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="nb">date</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="nb">date</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
<span class="w">  </span><span class="n">a</span><span class="p">.</span><span class="nb">date</span>
</pre></div>
</div>
</section>
<section id="multiple-join-conditions">
<h3>6: Multiple Join Conditions<a class="headerlink" href="#multiple-join-conditions" title="Permalink to this headline">#</a></h3>
<p><strong>Acknowledgement:</strong> This problem was inspired by Sisense’s <a class="reference external" href="https://www.sisense.com/blog/analyzing-your-email-with-sql/">“Analyzing Your Email with SQL”</a> blog post</p>
<p><strong>Context:</strong> Say we have a table <code class="docutils literal notranslate"><span class="pre">emails</span></code> that includes emails sent to and from <a class="reference external" href="mailto:zach&#37;&#52;&#48;g&#46;com"><code class="docutils literal notranslate"><span class="pre">zach&#64;g.com</span></code></a>:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>id</p></th>
<th class="head"><p>subject</p></th>
<th class="head"><p>from</p></th>
<th class="head"><p>to</p></th>
<th class="head"><p>timestamp</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Yosemite</p></td>
<td><p>zach&#64;g.com</p></td>
<td><p>thomas&#64;g.com</p></td>
<td><p>2018-01-02 12:45:03</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Big Sur</p></td>
<td><p>sarah&#64;g.com</p></td>
<td><p>thomas&#64;g.com</p></td>
<td><p>2018-01-02 16:30:01</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>Yosemite</p></td>
<td><p>thomas&#64;g.com</p></td>
<td><p>zach&#64;g.com</p></td>
<td><p>2018-01-02 16:35:04</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>Running</p></td>
<td><p>jill&#64;g.com</p></td>
<td><p>zach&#64;g.com</p></td>
<td><p>2018-01-03 08:12:45</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>Yosemite</p></td>
<td><p>zach&#64;g.com</p></td>
<td><p>thomas&#64;g.com</p></td>
<td><p>2018-01-03 14:02:01</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>Yosemite</p></td>
<td><p>thomas&#64;g.com</p></td>
<td><p>zach&#64;g.com</p></td>
<td><p>2018-01-03 15:01:05</p></td>
</tr>
<tr class="row-even"><td><p>..</p></td>
<td><p>..</p></td>
<td><p>..</p></td>
<td><p>..</p></td>
<td><p>..</p></td>
</tr>
</tbody>
</table>
<p><strong>Task:</strong> Write a query to get the response time per email (<code class="docutils literal notranslate"><span class="pre">id</span></code>) sent to <code class="docutils literal notranslate"><span class="pre">zach&#64;g.com</span></code> . Do not include <code class="docutils literal notranslate"><span class="pre">id</span></code>s that did not receive a response from <a class="reference external" href="mailto:zach&#37;&#52;&#48;g&#46;com">zach<span>&#64;</span>g<span>&#46;</span>com</a>. Assume each email thread has a unique subject. Keep in mind a thread may have multiple responses back-and-forth between <a class="reference external" href="mailto:zach&#37;&#52;&#48;g&#46;com">zach<span>&#64;</span>g<span>&#46;</span>com</a> and another email address.</p>
<hr class="docutils" />
<p><em><strong>Solution:</strong></em></p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="k">MIN</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="k">timestamp</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">timestamp</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">time_to_respond</span><span class="w"> </span>
<span class="k">FROM</span><span class="w"> </span>
<span class="w">    </span><span class="n">emails</span><span class="w"> </span><span class="n">a</span><span class="w"> </span>
<span class="k">JOIN</span>
<span class="w">    </span><span class="n">emails</span><span class="w"> </span><span class="n">b</span><span class="w"> </span>
<span class="w">        </span><span class="k">ON</span><span class="w"> </span>
<span class="w">            </span><span class="n">b</span><span class="p">.</span><span class="n">subject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">subject</span><span class="w"> </span>
<span class="w">        </span><span class="k">AND</span><span class="w"> </span>
<span class="w">            </span><span class="n">a</span><span class="p">.</span><span class="k">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="k">from</span>
<span class="w">        </span><span class="k">AND</span><span class="w"> </span>
<span class="w">            </span><span class="n">a</span><span class="p">.</span><span class="k">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="k">to</span><span class="w"> </span>
<span class="w">        </span><span class="k">AND</span><span class="w"> </span>
<span class="w">            </span><span class="n">a</span><span class="p">.</span><span class="k">timestamp</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="k">timestamp</span><span class="w"> </span>
<span class="w"> </span><span class="k">WHERE</span><span class="w"> </span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="k">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;zach@g.com&#39;</span><span class="w"> </span>
<span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="n">id</span><span class="w"> </span>
</pre></div>
</div>
</section>
</section>
<section id="window-function-practice-problems">
<h2>Window Function Practice Problems<a class="headerlink" href="#window-function-practice-problems" title="Permalink to this headline">#</a></h2>
<section id="get-the-id-with-the-highest-value">
<h3>1: Get the ID with the highest value<a class="headerlink" href="#get-the-id-with-the-highest-value" title="Permalink to this headline">#</a></h3>
<p><strong>Context:</strong> Say we have a table <code class="docutils literal notranslate"><span class="pre">salaries</span></code> with data on employee salary and department in the following format:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>depname</p></th>
<th class="head"><p>empno</p></th>
<th class="head"><p>salary</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>develop</p></td>
<td><p>11</p></td>
<td><p>5200</p></td>
</tr>
<tr class="row-odd"><td><p>develop</p></td>
<td><p>7</p></td>
<td><p>4200</p></td>
</tr>
<tr class="row-even"><td><p>develop</p></td>
<td><p>9</p></td>
<td><p>4500</p></td>
</tr>
<tr class="row-odd"><td><p>develop</p></td>
<td><p>8</p></td>
<td><p>6000</p></td>
</tr>
<tr class="row-even"><td><p>develop</p></td>
<td><p>10</p></td>
<td><p>5200</p></td>
</tr>
<tr class="row-odd"><td><p>personnel</p></td>
<td><p>5</p></td>
<td><p>3500</p></td>
</tr>
<tr class="row-even"><td><p>personnel</p></td>
<td><p>2</p></td>
<td><p>3900</p></td>
</tr>
<tr class="row-odd"><td><p>sales</p></td>
<td><p>3</p></td>
<td><p>4800</p></td>
</tr>
<tr class="row-even"><td><p>sales</p></td>
<td><p>1</p></td>
<td><p>5000</p></td>
</tr>
<tr class="row-odd"><td><p>sales</p></td>
<td><p>4</p></td>
<td><p>4800</p></td>
</tr>
</tbody>
</table>
<p><strong>Task</strong>: Write a query to get the <code class="docutils literal notranslate"><span class="pre">empno</span></code> with the highest salary. Make sure your solution can handle ties!</p>
<hr class="docutils" />
<p><em><strong>Solution:</strong></em></p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span><span class="w"> </span><span class="n">max_salary</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="k">MAX</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span><span class="w"> </span><span class="n">max_salary</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span>
<span class="w">        </span><span class="o">`</span><span class="n">salaries</span>
<span class="w">    </span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">s</span><span class="p">.</span><span class="n">empno</span>
<span class="k">FROM</span><span class="w"> </span>
<span class="w">    </span><span class="o">`</span><span class="n">salaries</span><span class="w"> </span><span class="n">s</span>
<span class="k">JOIN</span><span class="w"> </span>
<span class="w">    </span><span class="n">max_salary</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">salary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ms</span><span class="p">.</span><span class="n">max_salary</span><span class="w"> </span><span class="o">``</span>
</pre></div>
</div>
<p>Alternate solution using <code class="docutils literal notranslate"><span class="pre">RANK()</span></code>:</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span><span class="w"> </span><span class="n">sal_rank</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span>
<span class="w">  </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">empno</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">RANK</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">salary</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="n">rnk</span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span>
<span class="w">    </span><span class="n">salaries</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">  </span><span class="n">empno</span>
<span class="k">FROM</span>
<span class="w">  </span><span class="n">sal_rank</span>
<span class="k">WHERE</span><span class="w"> </span>
<span class="w">  </span><span class="n">rnk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="average-and-rank-with-a-window-function-multi-part">
<h3>2: Average and rank with a window function (multi-part)<a class="headerlink" href="#average-and-rank-with-a-window-function-multi-part" title="Permalink to this headline">#</a></h3>
<section id="id1">
<h4>Part 1:<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h4>
<p><strong>Context</strong>: Say we have a table <code class="docutils literal notranslate"><span class="pre">salaries</span></code> in the format:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>depname</p></th>
<th class="head"><p>empno</p></th>
<th class="head"><p>salary</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>develop</p></td>
<td><p>11</p></td>
<td><p>5200</p></td>
</tr>
<tr class="row-odd"><td><p>develop</p></td>
<td><p>7</p></td>
<td><p>4200</p></td>
</tr>
<tr class="row-even"><td><p>develop</p></td>
<td><p>9</p></td>
<td><p>4500</p></td>
</tr>
<tr class="row-odd"><td><p>develop</p></td>
<td><p>8</p></td>
<td><p>6000</p></td>
</tr>
<tr class="row-even"><td><p>develop</p></td>
<td><p>10</p></td>
<td><p>5200</p></td>
</tr>
<tr class="row-odd"><td><p>personnel</p></td>
<td><p>5</p></td>
<td><p>3500</p></td>
</tr>
<tr class="row-even"><td><p>personnel</p></td>
<td><p>2</p></td>
<td><p>3900</p></td>
</tr>
<tr class="row-odd"><td><p>sales</p></td>
<td><p>3</p></td>
<td><p>4800</p></td>
</tr>
<tr class="row-even"><td><p>sales</p></td>
<td><p>1</p></td>
<td><p>5000</p></td>
</tr>
<tr class="row-odd"><td><p>sales</p></td>
<td><p>4</p></td>
<td><p>4800</p></td>
</tr>
</tbody>
</table>
<p><strong>Task:</strong> Write a query that returns the same table, but with a new column that has average salary per <code class="docutils literal notranslate"><span class="pre">depname</span></code>. We would expect a table in the form:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>depname</p></th>
<th class="head"><p>empno</p></th>
<th class="head"><p>salary</p></th>
<th class="head"><p>avg_salary</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>develop</p></td>
<td><p>11</p></td>
<td><p>5200</p></td>
<td><p>5020</p></td>
</tr>
<tr class="row-odd"><td><p>develop</p></td>
<td><p>7</p></td>
<td><p>4200</p></td>
<td><p>5020</p></td>
</tr>
<tr class="row-even"><td><p>develop</p></td>
<td><p>9</p></td>
<td><p>4500</p></td>
<td><p>5020</p></td>
</tr>
<tr class="row-odd"><td><p>develop</p></td>
<td><p>8</p></td>
<td><p>6000</p></td>
<td><p>5020</p></td>
</tr>
<tr class="row-even"><td><p>develop</p></td>
<td><p>10</p></td>
<td><p>5200</p></td>
<td><p>5020</p></td>
</tr>
<tr class="row-odd"><td><p>personnel</p></td>
<td><p>5</p></td>
<td><p>3500</p></td>
<td><p>3700</p></td>
</tr>
<tr class="row-even"><td><p>personnel</p></td>
<td><p>2</p></td>
<td><p>3900</p></td>
<td><p>3700</p></td>
</tr>
<tr class="row-odd"><td><p>sales</p></td>
<td><p>3</p></td>
<td><p>4800</p></td>
<td><p>4867</p></td>
</tr>
<tr class="row-even"><td><p>sales</p></td>
<td><p>1</p></td>
<td><p>5000</p></td>
<td><p>4867</p></td>
</tr>
<tr class="row-odd"><td><p>sales</p></td>
<td><p>4</p></td>
<td><p>4800</p></td>
<td><p>4867</p></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
<p><em><strong>Solution:</strong></em></p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="o">*</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="cm">/*</span>
<span class="cm">    * AVG() is a Postgres command, but other SQL flavors like BigQuery use </span>
<span class="cm">    * AVERAGE()</span>
<span class="cm">    */</span><span class="w"> </span>
<span class="w">    </span><span class="n">ROUND</span><span class="p">(</span><span class="k">AVG</span><span class="p">(</span><span class="n">salary</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">OVER</span><span class="w"> </span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">depname</span><span class="p">)</span><span class="w"> </span><span class="n">avg_salary</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">salaries</span>
</pre></div>
</div>
</section>
<section id="id2">
<h4>Part 2:<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h4>
<p><strong>Task:</strong> Write a query that adds a column with the rank of each employee based on their salary within their department, where the employee with the highest salary gets the rank of <code class="docutils literal notranslate"><span class="pre">1</span></code>. We would expect a table in the form:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>depname</p></th>
<th class="head"><p>empno</p></th>
<th class="head"><p>salary</p></th>
<th class="head"><p>salary_rank</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>develop</p></td>
<td><p>11</p></td>
<td><p>5200</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>develop</p></td>
<td><p>7</p></td>
<td><p>4200</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-even"><td><p>develop</p></td>
<td><p>9</p></td>
<td><p>4500</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>develop</p></td>
<td><p>8</p></td>
<td><p>6000</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>develop</p></td>
<td><p>10</p></td>
<td><p>5200</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>personnel</p></td>
<td><p>5</p></td>
<td><p>3500</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>personnel</p></td>
<td><p>2</p></td>
<td><p>3900</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>sales</p></td>
<td><p>3</p></td>
<td><p>4800</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>sales</p></td>
<td><p>1</p></td>
<td><p>5000</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>sales</p></td>
<td><p>4</p></td>
<td><p>4800</p></td>
<td><p>2</p></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
<p><em><strong>Solution:</strong></em></p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="o">*</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">RANK</span><span class="p">()</span><span class="w"> </span><span class="n">OVER</span><span class="p">(</span><span class="n">PARTITION</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">depname</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">salary</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> </span><span class="n">salary_rank</span>
<span class="w"> </span><span class="k">FROM</span><span class="w">  </span>
<span class="w">    </span><span class="n">salaries</span><span class="w"> </span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="other-medium-hard-sql-practice-problems">
<h2>Other Medium/Hard SQL Practice Problems<a class="headerlink" href="#other-medium-hard-sql-practice-problems" title="Permalink to this headline">#</a></h2>
<section id="histograms">
<h3>1: Histograms<a class="headerlink" href="#histograms" title="Permalink to this headline">#</a></h3>
<p><strong>Context:</strong> Say we have a table <code class="docutils literal notranslate"><span class="pre">sessions</span></code> where each row is a video streaming session with length in seconds:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>session_id</p></th>
<th class="head"><p>length_seconds</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>23</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>453</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>27</p></td>
</tr>
<tr class="row-odd"><td><p>..</p></td>
<td><p>..</p></td>
</tr>
</tbody>
</table>
<p><strong>Task:</strong> Write a query to count the number of sessions that fall into bands of size 5, i.e. for the above snippet, produce something akin to:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>bucket</p></th>
<th class="head"><p>count</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>20-25</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>450-455</p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
<p>Get complete credit for the proper string labels (“5-10”, etc.) but near complete credit for something that is communicable as the bin.</p>
<hr class="docutils" />
<p><em><strong>Solution:</strong></em></p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span><span class="w"> </span><span class="n">bin_label</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span>
<span class="p">(</span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="n">session_id</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">FLOOR</span><span class="p">(</span><span class="n">length_seconds</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">bin_label</span><span class="w"> </span>
<span class="w"> </span><span class="k">FROM</span>
<span class="w">    </span><span class="n">sessions</span><span class="w"> </span>
<span class="w"> </span><span class="p">)</span>
<span class="w"> </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="o">`</span><span class="n">CONCATENTATE</span><span class="p">(</span><span class="n">STR</span><span class="p">(</span><span class="n">bin_label</span><span class="o">*</span><span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">STR</span><span class="p">(</span><span class="o">`</span><span class="n">bin_label</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="mi">5</span><span class="p">))</span><span class="w"> </span><span class="n">bucket</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">session_id</span><span class="p">)</span><span class="w"> </span><span class="k">count</span><span class="w"> </span><span class="o">``</span>
<span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
<span class="w">    </span><span class="n">bin_label</span>
<span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
<span class="w">    </span><span class="o">`</span><span class="n">bin_label</span><span class="w"> </span><span class="k">ASC</span><span class="w"> </span><span class="o">`</span>
</pre></div>
</div>
</section>
<section id="cross-join-multi-part">
<h3>2: CROSS JOIN (multi-part)<a class="headerlink" href="#cross-join-multi-part" title="Permalink to this headline">#</a></h3>
<section id="id3">
<h4>Part 1:<a class="headerlink" href="#id3" title="Permalink to this headline">#</a></h4>
<p><strong>Context:</strong> Say we have a table <code class="docutils literal notranslate"><span class="pre">state_streams</span></code> where each row is a state and the total number of hours of streaming from a video hosting service:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>state</p></th>
<th class="head"><p>total_streams</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>NC</p></td>
<td><p>34569</p></td>
</tr>
<tr class="row-odd"><td><p>SC</p></td>
<td><p>33999</p></td>
</tr>
<tr class="row-even"><td><p>CA</p></td>
<td><p>98324</p></td>
</tr>
<tr class="row-odd"><td><p>MA</p></td>
<td><p>19345</p></td>
</tr>
<tr class="row-even"><td><p>..</p></td>
<td><p>..</p></td>
</tr>
</tbody>
</table>
<p>(In reality these kinds of aggregate tables would normally have a date column, but we’ll exclude that component in this problem)</p>
<p><strong>Task:</strong> Write a query to get the pairs of states with total streaming amounts within 1000 of each other. For the snippet above, we would want to see something like:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>state_a</p></th>
<th class="head"><p>state_b</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>NC</p></td>
<td><p>SC</p></td>
</tr>
<tr class="row-odd"><td><p>SC</p></td>
<td><p>NC</p></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
<p><em><strong>Solution:</strong></em></p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="k">state</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">state_a</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">b</span><span class="p">.</span><span class="k">state</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">state_b</span><span class="w"> </span>
<span class="w"> </span><span class="k">FROM</span><span class="w">   </span>
<span class="w">    </span><span class="n">state_streams</span><span class="w"> </span><span class="n">a</span>
<span class="w"> </span><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span>
<span class="w">    </span><span class="n">state_streams</span><span class="w"> </span><span class="n">b</span><span class="w"> </span>
<span class="w"> </span><span class="k">WHERE</span><span class="w"> </span>
<span class="w">    </span><span class="k">ABS</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">total_streams</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">total_streams</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1000</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="k">state</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="k">state</span><span class="w"> </span>
</pre></div>
</div>
<p>FYI, <code class="docutils literal notranslate"><span class="pre">CROSS</span> <span class="pre">JOIN</span></code> s can also be written without explicitly specifying a join:</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="k">state</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">state_a</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">b</span><span class="p">.</span><span class="k">state</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">state_b</span><span class="w"> </span>
<span class="w"> </span><span class="k">FROM</span><span class="w">   </span>
<span class="w">    </span><span class="n">state_streams</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">state_streams</span><span class="w"> </span><span class="n">b</span><span class="w"> </span>
<span class="w"> </span><span class="k">WHERE</span><span class="w"> </span>
<span class="w">    </span><span class="k">ABS</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">total_streams</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">total_streams</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1000</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="k">state</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="k">state</span><span class="w"> </span>
</pre></div>
</div>
</section>
<section id="id4">
<h4>Part 2:<a class="headerlink" href="#id4" title="Permalink to this headline">#</a></h4>
<p><strong>Note:</strong> This question is considered more of a bonus problem than an actual SQL pattern. Feel free to skip it!</p>
<p><strong>Task:</strong> How could you modify the SQL from the solution to Part 1 of this question so that duplicates are removed? For example, if we used the sample table from Part 1, the pair <code class="docutils literal notranslate"><span class="pre">NC</span></code> and <code class="docutils literal notranslate"><span class="pre">SC</span></code> should only appear in one row instead of two.</p>
<hr class="docutils" />
<p><strong>Solution:</strong></p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="k">state</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">state_a</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">b</span><span class="p">.</span><span class="k">state</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">state_b</span><span class="w"> </span>
<span class="w"> </span><span class="k">FROM</span><span class="w">   </span>
<span class="w">    </span><span class="n">state_streams</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">state_streams</span><span class="w"> </span><span class="n">b</span><span class="w"> </span>
<span class="w"> </span><span class="k">WHERE</span><span class="w"> </span>
<span class="w">    </span><span class="k">ABS</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">total_streams</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">total_streams</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1000</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="k">state</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="k">state</span><span class="w"> </span>
</pre></div>
</div>
</section>
</section>
<section id="advancing-counting">
<h3>3: Advancing Counting<a class="headerlink" href="#advancing-counting" title="Permalink to this headline">#</a></h3>
<p><strong>Acknowledgement:</strong> This question is adapted from <a class="reference external" href="https://stackoverflow.com/questions/54488894/using-case-to-properly-count-items-with-if-else-logic-in-sql">this Stack Overflow question</a> by me (zthomas.nc)</p>
<p><strong>Note:</strong> this question is probably more complex than the kind you would encounter in an interview. Consider it a challenge problem, or feel free to skip it!</p>
<p><strong>Context:</strong> Say I have a table <code class="docutils literal notranslate"><span class="pre">table</span></code> in the following form, where a <code class="docutils literal notranslate"><span class="pre">user</span></code> can be mapped to multiple values of <code class="docutils literal notranslate"><span class="pre">class</span></code>:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>user</p></th>
<th class="head"><p>class</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>a</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>b</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>b</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>b</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>a</p></td>
</tr>
</tbody>
</table>
<p><strong>Task:</strong> Assume there are only two possible values for <code class="docutils literal notranslate"><span class="pre">class</span></code>. Write a query to count the number of users in each class such that any user who has label <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> gets sorted into <code class="docutils literal notranslate"><span class="pre">b</span></code>, any user with just <code class="docutils literal notranslate"><span class="pre">a</span></code> gets sorted into <code class="docutils literal notranslate"><span class="pre">a</span></code> and any user with just <code class="docutils literal notranslate"><span class="pre">b</span></code> gets into <code class="docutils literal notranslate"><span class="pre">b</span></code>.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">table</span></code> that would result in the following table:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>class</p></th>
<th class="head"><p>count</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>a</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>b</p></td>
<td><p>2</p></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
<p><strong>Solution:</strong></p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span><span class="w"> </span><span class="n">usr_b_sum</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span>
<span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="k">user</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;b&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="n">num_b</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span>
<span class="w">        </span><span class="k">table</span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
<span class="w">        </span><span class="k">user</span>
<span class="p">),</span><span class="w"> </span>

<span class="n">usr_class_label</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span>
<span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">        </span><span class="k">user</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="n">num_b</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="s1">&#39;b&#39;</span><span class="w"> </span><span class="k">ELSE</span><span class="w"> </span><span class="s1">&#39;a&#39;</span><span class="w"> </span><span class="k">END</span><span class="w"> </span><span class="k">class</span><span class="w"> </span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span>
<span class="w">        </span><span class="n">usr_b_sum</span>
<span class="p">)</span>

<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="k">class</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="k">user</span><span class="p">)</span><span class="w"> </span><span class="k">count</span><span class="w"> </span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">usr_class_label</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
<span class="w">    </span><span class="k">class</span><span class="w"> </span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
<span class="w">    </span><span class="k">class</span><span class="w"> </span><span class="k">ASC</span>
</pre></div>
</div>
<p>Alternate solution: Using <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>s in the <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> statement and <code class="docutils literal notranslate"><span class="pre">UNION</span></code>:</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="ss">&quot;a&quot;</span><span class="w"> </span><span class="k">class</span><span class="p">,</span>
<span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span>
<span class="w">        </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;b&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">count</span><span class="w"> </span>
<span class="k">UNION</span>
<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="ss">&quot;b&quot;</span><span class="w"> </span><span class="k">class</span><span class="p">,</span>
<span class="w">    </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;b&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">count</span><span class="w"> </span>
</pre></div>
</div>
<p>Alternate solution: Since the problem as stated didn’t ask for generalizable solution, you can leverage the fact that <code class="docutils literal notranslate"><span class="pre">b</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">a</span></code> to produce this straightforward solution:</p>
<p><strong>Acknowledgement</strong>: Thanks to Karan Gadiya for contributing this solution. Thanks, KG!</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span><span class="w"> </span><span class="n">max_class</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">SELECT</span>
<span class="w">        </span><span class="k">user</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="k">MAX</span><span class="p">(</span><span class="k">class</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">class</span><span class="w"> </span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span>
<span class="w">        </span><span class="k">table</span><span class="w"> </span>
<span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
<span class="w">        </span><span class="k">user</span>
<span class="p">)</span>

<span class="k">SELECT</span><span class="w"> </span>
<span class="w">    </span><span class="k">class</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="k">user</span><span class="p">)</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">max_class</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span>
<span class="w">    </span><span class="k">class</span><span class="w">    </span>
</pre></div>
</div>
</section>
</section>
<section id="acknowledgments-and-additional-resources">
<h2>Acknowledgments and Additional Resources<a class="headerlink" href="#acknowledgments-and-additional-resources" title="Permalink to this headline">#</a></h2>
<p>Some of the problems listed here are adapted from old Periscope blog posts (mostly written around 2014 by <a class="reference external" href="https://www.linkedin.com/in/seangcook/">Sean Cook</a>, although his authorship seems to have been removed from the posts following SiSense’s <a class="reference external" href="https://www.sisense.com/blog/sisense-and-periscope-data-merge-2/">merger with</a> Periscope) or discussions from Stack Overflow; I’ve noted them at the start of questions as appropriate.</p>
<p><a class="reference external" href="https://selectstarsql.com/">Select Star SQL</a> has good <a class="reference external" href="https://selectstarsql.com/questions.html#challenge_questions">challenge questions</a> that are complementary to the questions in this doc.</p>
<p>Please note that these questions are not literal copies of SQL interview questions I have encountered while interviewing nor were they interview questions used at a company I have worked at or work at.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./CS"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>
    <script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="Note-HTML%20basics.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">HTML Basics</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="Note-Inside%20look%20at%20modern%20web%20browser.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Inside look at modern web browser</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Ming Yang<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>