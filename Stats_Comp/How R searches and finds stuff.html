
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>How R searches and finds stuff &#8212; Study Notes</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="[book] Hands-On Machine Learning with Scikit-Learn and TensorFlow" href="../DS_ML/Book-Hands-On%20Machine%20Learning%20with%20Scikit-Learn%20and%20TensorFlow.html" />
    <link rel="prev" title="Survival Analysis" href="../Stats/Note-Survival_Analysis.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Study Notes</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Study Notes Index
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Statistics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Book-Analysis%20of%20Observational%20Health%20Care%20Data%20Using%20SAS.html">
   [book] Analysis of Observational Health Care Data Using SAS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Book-Causal%20inference%20in%20statistics%20a%20primer.html">
   [book] Causal inference in statistics
   <em>
    a primer
   </em>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Book-Data%20Analysis%20Using%20Regression%20and%20Multilevel%20Hierarchical%20Models.html">
   [book] Data Analysis Using Regression and Multilevel/Hierarchical Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Book-Fundamentals%20of%20Clinical%20Trials%20%284th%20edition%29.html">
   [book] Fundamentals of Clinical Trials (4th edition)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Book-Group%20Sequential%20and%20Confirmatory%20Adaptive%20Designs%20in%20Clinical%20Trials.html">
   [book] Group Sequential and Confirmatory Adaptive Designs in Clinical Trials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Book-Regression%20Modeling%20Strategies.html">
   [book] Regression Modeling Strategies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Competing_Risk_Regression.html">
   Competing risk models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Cox_PH_model.html">
   ​Cox PH model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-FDA%20guidances%20for%20industry.html">
   Notes on FDA Guidances for Industry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Group_Sequential_Trial_Design.html">
   Notes on Group Sequential Trial Design​
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-ICH%20guidelines.html">
   Notes on ICH guidelines​
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Monte%20Carlo%20method.html">
   Monte Carlo Method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Multiplicity%20in%20Clinical%20Trials.html">
   Multiplicity in Clinical Trials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Quantile%20regression.html">
   Quantile regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Stats/Note-Survival_Analysis.html">
   Survival Analysis
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Statistical computing
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   How R searches and finds stuff
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  DS/ML
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Book-Hands-On%20Machine%20Learning%20with%20Scikit-Learn%20and%20TensorFlow.html">
   [book] Hands-On Machine Learning with Scikit-Learn and TensorFlow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Book-Python%20Data%20Science%20Handbook.html">
   [book] Python Data Science Handbook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Note-Boosting.html">
   Boosting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Note-Cluster%20analysis.html">
   Cluster analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Note-Machine%20Learning%20%28General%29.html">
   ​Machine Learning (General)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Note-Naive%20Bayes.html">
   Naive Bayes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Note-Stochasitic%20Gradient%20Descent.html">
   Stochastic Gradient Decent (SGD)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../DS_ML/Note-Tree%2C%20Random%20Forest%20%28Bagging%29.html">
   Tree/Random Forest (Bagging)
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Miscellaneous
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Miscellaneous/Miscellaneous%20Notes.html">
   Miscellaneous Study Notes
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/Stats_Comp/How R searches and finds stuff.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/askming/study_notes"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/askming/study_notes/issues/new?title=Issue%20on%20page%20%2FStats_Comp/How R searches and finds stuff.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#play-time-with-environemnts">
   Play time with Environemnts
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#short-answer-how-r-searches-and-finds-stuff">
   Short Answer: How R Searches and Finds stuff
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#map-of-the-world-follow-the-purple-line-road">
   Map of the World (follow the purple line road)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-global-environment">
   The Global Environment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-search-list">
   The Search List
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#package-v-namespace-v-imports-environments">
   Package v. Namespace v. Imports Environments
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports-v-depends">
   Imports v Depends
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#namespace-base">
   namespace:base
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-curveball-the-dotted-purple-lines">
   The Curveball (the dotted purple lines)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#passing-functions">
   Passing Functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#that-creepy-caller">
   That Creepy Caller
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#finally-how-r-searches-and-finds-stuff">
   Finally, How R searches and finds stuff
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#qualitative-comments">
   Qualitative Comments
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#skip-the-search-and-find">
   Skip the search-and-find
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="how-r-searches-and-finds-stuff">
<h1><a class="reference external" href="https://blog.obeautifulcode.com/R/How-R-Searches-And-Finds-Stuff/">How R searches and finds stuff</a><a class="headerlink" href="#how-r-searches-and-finds-stuff" title="Permalink to this headline">¶</a></h1>
<p>by <em>Suraj Gupta</em></p>
<hr>
<ul>
<li><p>Everything in R lives in an <strong>environment</strong>.</p></li>
<li><p>Ultimately, we’re trying to figure out which environment something lives in, and how we get there (or how we got there)</p></li>
<li><p>An environment, like everything else in R is an object. Objects hold stuff. Environments are specialized, they can only hold two things:</p>
<ul>
<li><p>A <strong>frame</strong></p>
<ul class="simple">
<li><p>This is just a collection of named objects. Since everything in R lives in an environment and the frame is the place where an environment holds objects</p></li>
</ul>
</li>
<li><p><strong>Enclosing environment</strong> (environment’s owner)</p>
<ul>
<li><p>This is just a reference to another environment (parent environment).</p></li>
<li><p>The chain of enclosing environments stops at a special environment called the <strong>Empty Environment</strong>, which can be accessed with <code class="docutils literal notranslate"><span class="pre">emptyenv()</span></code>.</p>
<p><img alt="environment-structure" src="https://raw.githubusercontent.com/askming/picgo/master/environment-structure.png" /></p>
</li>
<li><p>Given an environment object, you can query the object for the two things that matter: the environment’s owner and the objects in the frame.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="section" id="play-time-with-environemnts">
<h2>Play time with Environemnts<a class="headerlink" href="#play-time-with-environemnts" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>Create a new environment</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">myEnvironment</span> <span class="o">=</span> <span class="nf">new.env</span><span class="p">()</span> 
<span class="o">&gt;</span> <span class="n">myEnvironment</span> 
<span class="o">&lt;</span><span class="n">environment</span><span class="o">:</span> <span class="mh">0x0000000006ce0920</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p>Every environment (except R_EmptyEnv) has an enclosure</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="nf">parent.env</span><span class="p">(</span><span class="n">myEnvironment</span><span class="p">)</span> 
<span class="o">&lt;</span><span class="n">environment</span><span class="o">:</span> <span class="n">R_GlobalEnv</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p>Who’s R_GlobalEnv’s enclosing environment?</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="nf">parent.env</span><span class="p">(</span> <span class="nf">parent.env</span><span class="p">(</span> <span class="n">myEnvironment</span> <span class="p">)</span> <span class="p">)</span> 
<span class="o">&lt;</span><span class="n">environment</span><span class="o">:</span> <span class="n">package</span><span class="o">:</span><span class="n">stats</span><span class="o">&gt;</span>
<span class="nf">attr</span><span class="p">(,</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;package:stats&quot;</span>
<span class="nf">attr</span><span class="p">(,</span><span class="s">&quot;path&quot;</span><span class="p">)</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;C:/R/R-2.14.1/library/stats&quot;</span>
</pre></div>
</div>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">R_GlobalEnv</span></code> must be special if it can be retrieved using the identifier <code class="docutils literal notranslate"><span class="pre">.GlobalEnv</span></code> AND a function <code class="docutils literal notranslate"><span class="pre">globalenv()</span></code></p></li>
<li><p>The empty environment is accessed using <code class="docutils literal notranslate"><span class="pre">emptyenv()</span></code></p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="nf">emptyenv</span><span class="p">()</span>
<span class="o">&lt;</span><span class="n">environment</span><span class="o">:</span> <span class="n">R_EmptyEnv</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;environment:</span> <span class="pre">0x0000000006ce0920&gt;</span></code> is the location of the environment in memory. We can add a friendly name by assigning a “name” attribute.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="nf">attr</span><span class="p">(</span> <span class="n">myEnvironment</span> <span class="p">,</span> <span class="s">&quot;name&quot;</span> <span class="p">)</span> <span class="o">=</span> <span class="s">&quot;Cool Name&quot;</span> 
<span class="o">&gt;</span> <span class="n">myEnvironment</span> 
<span class="o">&lt;</span><span class="n">environment</span><span class="o">:</span> <span class="mh">0x0000000006ce0920</span><span class="o">&gt;</span>
<span class="nf">attr</span><span class="p">(,</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;Cool Name&quot;</span>
<span class="o">&gt;</span> <span class="nf">environmentName</span><span class="p">(</span> <span class="n">myEnvironment</span> <span class="p">)</span> 
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;Cool Name&quot;</span>
</pre></div>
</div>
</li>
<li><p>Unless you try hard, when you create an object it is automatically placed in the “current” or “local” environment, accessible using <code class="docutils literal notranslate"><span class="pre">environment()</span></code>; And we can query an environment for all objects in the frame using <code class="docutils literal notranslate"><span class="pre">ls()</span></code>.</p></li>
<li><p>We can override the default behavior and create an object in an environment other than the local environment using the <code class="docutils literal notranslate"><span class="pre">assign()</span></code> function.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="nf">ls</span><span class="p">(</span> <span class="n">envir</span> <span class="o">=</span> <span class="n">myEnvironment</span> <span class="p">)</span>
<span class="nf">character</span><span class="p">(</span><span class="m">0</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="nf">assign</span><span class="p">(</span> <span class="s">&quot;myLogical&quot;</span> <span class="p">,</span> <span class="nf">c</span><span class="p">(</span> <span class="kc">FALSE</span> <span class="p">,</span> <span class="kc">TRUE</span> <span class="p">)</span> <span class="p">,</span> <span class="n">envir</span> <span class="o">=</span> <span class="n">myEnvironment</span> <span class="p">)</span>
<span class="o">&gt;</span> <span class="nf">ls</span><span class="p">(</span> <span class="n">envir</span> <span class="o">=</span> <span class="n">myEnvironment</span> <span class="p">)</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;myLogical&quot;</span>
</pre></div>
</div>
</li>
<li><p>We can retrieve any named object from any given environment using the <code class="docutils literal notranslate"><span class="pre">get()</span></code> function</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="nf">get</span><span class="p">(</span> <span class="s">&quot;myLogical&quot;</span> <span class="p">,</span> <span class="n">envir</span> <span class="o">=</span> <span class="n">myEnvironment</span> <span class="p">)</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="kc">FALSE</span>  <span class="kc">TRUE</span>
</pre></div>
</div>
</li>
<li><p>R uses the local environment as the default value. You can change an environment’s enclosure using the replacement form of <code class="docutils literal notranslate"><span class="pre">parent.env()</span></code>.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">myEnvironment2</span> <span class="o">=</span> <span class="nf">new.env</span><span class="p">()</span>
<span class="o">&gt;</span> <span class="nf">parent.env</span><span class="p">(</span> <span class="n">myEnvironment2</span> <span class="p">)</span>
<span class="o">&lt;</span><span class="n">environment</span><span class="o">:</span> <span class="n">R_GlobalEnv</span><span class="o">&gt;</span>
<span class="o">&gt;</span> <span class="nf">parent.env</span><span class="p">(</span> <span class="n">myEnvironment2</span> <span class="p">)</span> <span class="o">=</span> <span class="n">myEnvironment</span>
<span class="o">&gt;</span> <span class="nf">parent.env</span><span class="p">(</span> <span class="n">myEnvironment2</span> <span class="p">)</span>
<span class="o">&lt;</span><span class="n">environment</span><span class="o">:</span> <span class="mh">0x0000000006ce0920</span><span class="o">&gt;</span>
<span class="nf">attr</span><span class="p">(,</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;Cool Name&quot;</span>
</pre></div>
</div>
</li>
<li><p>Another way to understand the “current” or “local” environment: We create a function that calls <code class="docutils literal notranslate"><span class="pre">environment()</span></code> to query for the local environment. When R executes a function it automatically creates a new environment for that function. This is useful - variables/objects created inside the function will live in the new local environment.</p></li>
<li><p>We call <code class="docutils literal notranslate"><span class="pre">Test()</span></code> to verify this. We can see that <code class="docutils literal notranslate"><span class="pre">Test()</span></code> does NOT print <code class="docutils literal notranslate"><span class="pre">R_GlobalEnv</span></code>. We didn’t create any objects within <code class="docutils literal notranslate"><span class="pre">Test()</span></code>. If we had, they would live in the <code class="docutils literal notranslate"><span class="pre">0x0000000006ce9b58</span></code> environment while <code class="docutils literal notranslate"><span class="pre">Test()</span></code> is running. When the function completes executing, the environment dies.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">Test</span> <span class="o">=</span> <span class="nf">function</span><span class="p">()</span> <span class="p">{</span> <span class="nf">print</span><span class="p">(</span> <span class="nf">environment</span><span class="p">()</span> <span class="p">)</span> <span class="p">}</span> 
<span class="o">&gt;</span> <span class="nf">environment</span><span class="p">()</span>
<span class="o">&lt;</span><span class="n">environment</span><span class="o">:</span> <span class="n">R_GlobalEnv</span><span class="o">&gt;</span>
<span class="o">&gt;</span> <span class="nf">Test</span><span class="p">()</span> 
<span class="o">&lt;</span><span class="n">environment</span><span class="o">:</span> <span class="mh">0x0000000006ce9b58</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="short-answer-how-r-searches-and-finds-stuff">
<h2>Short Answer: How R Searches and Finds stuff<a class="headerlink" href="#short-answer-how-r-searches-and-finds-stuff" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>It seems that environments are not just static repositories of objects. When R executes an expression, there is always one <em>local</em> or <em>current</em> environment. Maybe its easier to think of this as the <em>active</em> environment, in contrast to the other environments which are <em>inactive</em>. Or perhaps its more intuitive to think of an expression executing “within” a particular environment. The point here is that at any moment R can ask “hey, what’s the local environment.” R asks this questions a lot. In fact, it asks this question every time it needs to find a named object. We saw that R creates a new local environments every time it runs a function. So when we run any decently involved piece of code, functions call other function and environments spawn and die.</p></li>
<li><p>When R goes searching for the names in that expression, it first looks at the objects within the local environment. If the object is not found by name in that environment, then R searches the enclosing environment of the local environment. If the object is not in the enclosure, then R searches the enclosure’s enclosure, and so on. That’s how R searches and finds stuff; it traverses the enclosing environments and stops at the first environment that contains the named object.</p></li>
</ul>
</div>
<div class="section" id="map-of-the-world-follow-the-purple-line-road">
<h2>Map of the World (follow the purple line road)<a class="headerlink" href="#map-of-the-world-follow-the-purple-line-road" title="Permalink to this headline">¶</a></h2>
<p><img alt="map-of-the-world" src="https://raw.githubusercontent.com/askming/picgo/master/map-of-the-world.png" /></p>
<p>This graphic shows the state of all environments when you first startup R. Each box represents a unique environment. The solid purple line represents the enclosing environment relationship. I’ll explain the dotted purple line in a bit. For now, consider it a relationship that’s similar to the enclosing environment.</p>
</div>
<div class="section" id="the-global-environment">
<h2>The Global Environment<a class="headerlink" href="#the-global-environment" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The global environment is precisely the environment that you start at when you launch R. It is your <em>current</em> or <em>local</em> environment when R launches. If you make an assignment at the prompt, the named object is stored in <code class="docutils literal notranslate"><span class="pre">R_GlobalEnv</span></code>.</p></li>
<li><p>Be careful with the <code class="docutils literal notranslate"><span class="pre">environment()</span></code> function. It might seem wrong that this returns <code class="docutils literal notranslate"><span class="pre">NULL</span></code> but if you read the documentation you’ll see that <code class="docutils literal notranslate"><span class="pre">environment()</span></code> takes a function as input. <code class="docutils literal notranslate"><span class="pre">myVariable</span></code> is not a function, its a numeric.  The purpose of <code class="docutils literal notranslate"><span class="pre">environment()</span></code> is not to tell you an object’s owner.</p></li>
</ul>
</div>
<div class="section" id="the-search-list">
<h2>The Search List<a class="headerlink" href="#the-search-list" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>In R, the “search list” is the chain of enclosing environments starting with <code class="docutils literal notranslate"><span class="pre">R_GlobalEnv</span></code> and ending with <code class="docutils literal notranslate"><span class="pre">R_EmptyEnv</span></code>. I like to think of it as the main highway on our map. This is the highway that R drives down when we start in <code class="docutils literal notranslate"><span class="pre">R_GlobalEnv</span></code>. All roads in our world eventually lead to this highway. You can obtain the search list by typing <code class="docutils literal notranslate"><span class="pre">search()</span></code> at the prompt:</p></li>
</ul>
</div>
<div class="section" id="package-v-namespace-v-imports-environments">
<h2>Package v. Namespace v. Imports Environments<a class="headerlink" href="#package-v-namespace-v-imports-environments" title="Permalink to this headline">¶</a></h2>
<p><img alt="package-namespace-imports" src="https://raw.githubusercontent.com/askming/picgo/master/package-namespace-imports.png" /></p>
<ol>
<li><p><strong>package environment</strong></p>
<ul class="simple">
<li><p>This is where a package’s <em>exported</em> objects go.</p></li>
<li><p>Simply put, these are the objects that the package author wants you to see. These are most likely functions.</p></li>
<li><p>In traditional Object Oriented Programming (OOP), this is analogous to a “public” class or method.</p></li>
</ul>
</li>
<li><p><strong>namespace environment</strong></p>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>The latter, the “hidden” objects (they are not really hidden, you can access them if you’d like) facilitate the “visible” ones.</p>
</div>
<ul class="simple">
<li><p>This is where <em>all</em> objects in a package go. This includes objects the package author wants you see. It also includes objects that are not meant to be accessed by the end-user<a class="footnote-reference brackets" href="#id2" id="id1">1</a>. In OOP this is analogous to a “private” or “internal” class or method.</p></li>
<li><p>You might be thinking “wait, so objects the author wants me to see are in BOTH the package environment and the namespace environment?” Yes and No. Yes, both environments have a frame that lists objects of the same name, but no there is not two copies. Both environments have <a class="reference external" href="http://stackoverflow.com/questions/9278715/value-reference-equality-for-same-named-function-in-package-namespace-environmen">pointers to the same function</a>.</p></li>
</ul>
</li>
<li><p><strong>imports environment</strong></p>
<ul class="simple">
<li><p>This environment contains objects from other packages that are explicitly stated requirements for a package to work properly. Most packages published on CRAN are not islands; they build on functionality provided in other packages. The <code class="docutils literal notranslate"><span class="pre">imports:package</span></code> environment contains all objects in the imported packages.</p></li>
</ul>
</li>
</ol>
</div>
<div class="section" id="imports-v-depends">
<h2>Imports v Depends<a class="headerlink" href="#imports-v-depends" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">Depends</span></code> section <em>also</em> lists packages that a package requires.The difference between <code class="docutils literal notranslate"><span class="pre">Imports</span></code> and <code class="docutils literal notranslate"><span class="pre">Depends</span></code> is where the requirement is placed on our map of the world. Because our map specifies the path R takes to find objects, there are consequences to specifying a requirement in <code class="docutils literal notranslate"><span class="pre">Imports</span></code> versus <code class="docutils literal notranslate"><span class="pre">Depends</span></code> in terms of how R finds the dependency.</p></li>
<li><p>If the package is specified in <code class="docutils literal notranslate"><span class="pre">Imports</span></code>, then the package contents will go into the “imports” environment.</p>
<ul>
<li><p>For example, In the case of ggplot2, the objects in the <code class="docutils literal notranslate"><span class="pre">plyr</span></code> package will appear in the <code class="docutils literal notranslate"><span class="pre">imports:ggplot2</span></code> environment. Notice also that <code class="docutils literal notranslate"><span class="pre">plyr</span></code> does not have a package environment. Its nicely tucked away inside the environment <code class="docutils literal notranslate"><span class="pre">imports:ggplot2</span></code>.</p>
<p><img alt="imports-depends-plyr" src="https://raw.githubusercontent.com/askming/picgo/master/imports-depends-plyr.png" /></p>
</li>
</ul>
</li>
<li><p>If a package is specified in <code class="docutils literal notranslate"><span class="pre">Depends</span></code> (i.e. <code class="docutils literal notranslate"><span class="pre">reshape</span></code> package), then the package is loaded as it would be if you called <code class="docutils literal notranslate"><span class="pre">library()</span></code> or <code class="docutils literal notranslate"><span class="pre">require()</span></code> from the R prompt. That is, the package, namespace, and imports environments are created for the dependency and placed on our map. The reshape package is attached <em>before</em> <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> and the <code class="docutils literal notranslate"><span class="pre">package:reshape</span></code> environment becomes <code class="docutils literal notranslate"><span class="pre">package:ggplot2</span></code>’s enclosing environment.</p>
<p><img alt="imports-depends-reshape" src="https://raw.githubusercontent.com/askming/picgo/master/imports-depends-reshape.png" /></p>
</li>
<li><p>Is the choice between Depends and Imports arbitrary? Its not. The <code class="docutils literal notranslate"><span class="pre">library()</span></code> command (or generally attaching a library) places the package environment under <code class="docutils literal notranslate"><span class="pre">R_Global</span></code>. More precisely, the package environment becomes <code class="docutils literal notranslate"><span class="pre">R_Global</span></code>’s enclosing environment. <code class="docutils literal notranslate"><span class="pre">R_Global</span></code>’s old enclosure now encloses the package environment.</p>
<p><img alt="reshape-reshape2-cast-conflict" src="https://raw.githubusercontent.com/askming/picgo/master/reshape-reshape2-cast-conflict.png" /></p>
<ul class="simple">
<li><p>Both <code class="docutils literal notranslate"><span class="pre">reshape</span></code> and <code class="docutils literal notranslate"><span class="pre">reshape2</span></code> contain the function <code class="docutils literal notranslate"><span class="pre">cast</span></code>. Lets say (I’m making this up) that <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> has a function called <code class="docutils literal notranslate"><span class="pre">FunctionThatCallsCast()</span></code>. As you can guess, this function calls the <code class="docutils literal notranslate"><span class="pre">cast()</span></code> function. Without knowing any details of how R finds stuff, lets just follow the “purple line road”. We travel from to 1 and 2 and find <code class="docutils literal notranslate"><span class="pre">FunctionThatCallsCast()</span></code>. Remember, the package and namespace environments both reference a package’s public-facing functions. We execute that function and now we need to find <code class="docutils literal notranslate"><span class="pre">cast</span></code>. We travel from 3 to 5 searching for <code class="docutils literal notranslate"><span class="pre">cast</span></code>. We find <code class="docutils literal notranslate"><span class="pre">cast</span></code> at 6 and stop. But this is the <em>wrong</em> <code class="docutils literal notranslate"><span class="pre">cast</span></code>. This is <code class="docutils literal notranslate"><span class="pre">cast</span></code> in package <code class="docutils literal notranslate"><span class="pre">reshape2</span></code>, but <code class="docutils literal notranslate"><span class="pre">ggplot</span></code> depends on the <code class="docutils literal notranslate"><span class="pre">cast</span></code> in <code class="docutils literal notranslate"><span class="pre">reshape</span></code>. This could have dire consequences depending on the differences between <code class="docutils literal notranslate"><span class="pre">cast</span></code> in <code class="docutils literal notranslate"><span class="pre">reshape</span></code> and <code class="docutils literal notranslate"><span class="pre">reshape2</span></code>.</p></li>
<li><p>The better solution would have been to stuff <code class="docutils literal notranslate"><span class="pre">reshape</span></code>’s <code class="docutils literal notranslate"><span class="pre">cast()</span></code> function into <code class="docutils literal notranslate"><span class="pre">imports:ggplot2</span></code> using the <code class="docutils literal notranslate"><span class="pre">Imports</span></code> feature. In that case, we would have travelled from 2 to 3 and stopped. Now you can see why the choice between <code class="docutils literal notranslate"><span class="pre">Imports</span></code> and <code class="docutils literal notranslate"><span class="pre">Depends</span></code> is not arbitrary. With so many packages on CRAN and so many of us working in related disciplines its no surprise that same-named functions appear in multiple packages. <code class="docutils literal notranslate"><span class="pre">Depends</span></code> is less safe. <code class="docutils literal notranslate"><span class="pre">Depends</span></code> makes a package vulnerable to whatever other packages are loaded by the user.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="namespace-base">
<h2>namespace:base<a class="headerlink" href="#namespace-base" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>All <code class="docutils literal notranslate"><span class="pre">imports:&lt;name&gt;</span></code> environments have <code class="docutils literal notranslate"><span class="pre">namespace:base</span></code> as their enclosure. Think of this a freebie for creating a package. Since the base functions are used frequently, they are most likely a dependency for any package (or a package’s imports). Without <code class="docutils literal notranslate"><span class="pre">namespace:base</span></code> where it is, R would have to go hunting quite far to find <code class="docutils literal notranslate"><span class="pre">package:base</span></code>. There’s a big risk that another package has a function of the same name as a base function.</p></li>
<li><p>A package author cannot know a-prior when you intend to attach her package nor that you have decided to write your own version of a base function. So do as you like, a package author can expect that R will find the base functions immediately after <code class="docutils literal notranslate"><span class="pre">Imports</span></code>. There’s no chance of corruption.</p></li>
</ul>
</div>
<div class="section" id="the-curveball-the-dotted-purple-lines">
<h2>The Curveball (the dotted purple lines)<a class="headerlink" href="#the-curveball-the-dotted-purple-lines" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>Functions, like all objects, are housed inside environments. However, functions themselves have a property which is a pointer to the environment in which they should run. When you create a function, that property is automatically set to the environment in which the function was created. So the environment that houses a function and the environment that the function will run in is one and the same.</p>
<p><img alt="environment-property" src="https://raw.githubusercontent.com/askming/picgo/master/environment-property.png" /></p>
</li>
<li><p><em>“The environment that a function will run in”</em>: executing a function creates a new environment specifically for that function and the enclosing environment function’s new environment is what is specified by the function’s environment property. This is “the environment that a function will run in.” We can get a function object’s environment property using the <code class="docutils literal notranslate"><span class="pre">environment()</span></code> function.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">MyFunction</span> <span class="o">=</span> <span class="nf">function</span><span class="p">()</span> <span class="p">{}</span> 
<span class="o">&gt;</span> <span class="nf">environment</span><span class="p">(</span> <span class="n">MyFunction</span> <span class="p">)</span> 
<span class="o">&lt;</span><span class="n">environment</span><span class="o">:</span> <span class="n">R_GlobalEnv</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p>And when we run <code class="docutils literal notranslate"><span class="pre">MyFunction()</span></code> and R is executing lines of codes inside that function, the environments look like this:</p>
<p><img alt="environment-execution" src="https://raw.githubusercontent.com/askming/picgo/master/environment-execution.png" /></p>
</li>
<li><p>By default, R sets a function’s environment property equal to the environment where the function was created (the environment that owns the function). However, its not necessary that a function’s executing environment and the environment that owns the function are one and the same. In fact, we can change the environment to our liking:</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># notice how environment(MyFunction) no longer returns R_GlobalEnv</span>
<span class="o">&gt;</span> <span class="n">MyFunction</span> <span class="o">=</span> <span class="nf">function</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span> 
<span class="o">&gt;</span> <span class="n">newEnvironment</span> <span class="o">=</span> <span class="nf">new.env</span><span class="p">()</span> 
<span class="o">&gt;</span> <span class="nf">environment</span><span class="p">(</span> <span class="n">MyFunction</span> <span class="p">)</span> <span class="o">=</span> <span class="n">newEnvironment</span> 
<span class="o">&gt;</span> <span class="nf">environment</span><span class="p">(</span> <span class="n">MyFunction</span> <span class="p">)</span> 
<span class="o">&lt;</span><span class="n">environment</span><span class="o">:</span> <span class="mh">0x000000000e895628</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p>Another way to see a function’s environment property is to just print the function. The environment will appear at the bottom of the printed function.</p></li>
<li><p>How R searches for variables in a function call: find the “cloest” one to use first if not otherwise specifically specified for its enclosing environment</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">age</span> <span class="o">=</span> <span class="m">32</span> 
<span class="o">&gt;</span> <span class="n">MyFunction</span> <span class="o">=</span> <span class="nf">function</span><span class="p">()</span> 
<span class="o">+</span> <span class="p">{</span> 
<span class="o">+</span>     <span class="n">age</span> <span class="o">=</span> <span class="m">22</span> 
<span class="o">+</span>     <span class="n">FromLocal</span> <span class="o">=</span> <span class="nf">function</span><span class="p">()</span> <span class="p">{</span> <span class="nf">print</span><span class="p">(</span> <span class="n">age</span> <span class="o">+</span> <span class="m">1</span> <span class="p">)</span> <span class="p">}</span> 
<span class="o">+</span>     <span class="n">FromGlobal</span> <span class="o">=</span> <span class="nf">function</span><span class="p">()</span> <span class="p">{</span> <span class="nf">print</span><span class="p">(</span> <span class="n">age</span> <span class="o">+</span> <span class="m">1</span> <span class="p">)</span> <span class="p">}</span> 
<span class="o">+</span>     <span class="n">NoSearch</span> <span class="o">=</span>  <span class="nf">function</span><span class="p">()</span> <span class="p">{</span> <span class="n">age</span> <span class="o">=</span> <span class="m">11</span><span class="p">;</span> <span class="nf">print</span><span class="p">(</span> <span class="n">age</span> <span class="o">+</span> <span class="m">1</span> <span class="p">)</span> <span class="p">}</span> 
<span class="o">+</span>     <span class="nf">environment</span><span class="p">(</span> <span class="n">FromGlobal</span> <span class="p">)</span> <span class="o">=</span> <span class="n">.GlobalEnv</span> 
<span class="o">+</span>     <span class="nf">FromLocal</span><span class="p">()</span> 
<span class="o">+</span>     <span class="nf">FromGlobal</span><span class="p">()</span> 
<span class="o">+</span>     <span class="nf">NoSearch</span><span class="p">()</span> 
<span class="o">+</span> <span class="p">}</span> 
<span class="o">&gt;</span> <span class="nf">MyFunction</span><span class="p">()</span> 
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">23</span> 
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">33</span> 
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">12</span>
</pre></div>
</div>
</li>
<li><p>This explains the dotted purple lines in our map. If you inspect the environment property of the functions within the <code class="docutils literal notranslate"><span class="pre">package:&lt;name&gt;</span></code> environments you’ll see that they all point to the <code class="docutils literal notranslate"><span class="pre">namespace:&lt;name&gt;</span> <span class="pre">environment</span></code>. So in essence, the package environment is just a pass-thru to the namespace environment.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">statsPackageEnv</span> <span class="o">=</span> <span class="nf">as.environment</span><span class="p">(</span> <span class="s">&quot;package:stats&quot;</span> <span class="p">)</span> 
<span class="o">&gt;</span> <span class="n">sdFunc</span> <span class="o">=</span> <span class="nf">get</span><span class="p">(</span> <span class="s">&quot;sd&quot;</span> <span class="p">,</span> <span class="n">envir</span> <span class="o">=</span> <span class="n">statsPackageEnv</span> <span class="p">)</span> 
<span class="o">&gt;</span> <span class="nf">environment</span><span class="p">(</span> <span class="n">sdFunc</span> <span class="p">)</span> 
<span class="o">&lt;</span><span class="n">environment</span><span class="o">:</span> <span class="n">namespace</span><span class="o">:</span><span class="n">stats</span><span class="o">&gt;</span> 
<span class="o">&gt;</span> <span class="n">statsNamespaceEnv</span> <span class="o">=</span> <span class="nf">environment</span><span class="p">(</span> <span class="n">sdFunc</span> <span class="p">)</span> 
<span class="o">&gt;</span> <span class="n">sdFunc2</span> <span class="o">=</span> <span class="nf">get</span><span class="p">(</span> <span class="s">&quot;sd&quot;</span> <span class="p">,</span> <span class="n">envir</span> <span class="o">=</span> <span class="n">statsNamespaceEnv</span> <span class="p">)</span> 
<span class="o">&gt;</span> <span class="nf">environment</span><span class="p">(</span> <span class="n">sdFunc2</span> <span class="p">)</span> 
<span class="o">&lt;</span><span class="n">environment</span><span class="o">:</span> <span class="n">namespace</span><span class="o">:</span><span class="n">stats</span><span class="o">&gt;</span>

<span class="c1"># An easier way to get a namespace environment</span>
<span class="o">&gt;</span> <span class="n">statsNamespaceEnv</span> <span class="o">=</span> <span class="nf">asNamespace</span><span class="p">(</span> <span class="s">&quot;stats&quot;</span> <span class="p">)</span> 
<span class="o">&gt;</span> <span class="n">statsNamespaceEnv</span> 
<span class="o">&lt;</span><span class="n">environment</span><span class="o">:</span> <span class="n">namespace</span><span class="o">:</span><span class="n">stats</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p>The package environment says “I don’t know what to do, ask my functions”. And when we ask the functions they all say “when you execute us create a new environment whose enclosure is the namespace environment.” More precisely, the functions are just offering up their environment property . We might as well make those dotted lines solid:</p>
<p><img alt="map-of-the-world-complete" src="https://raw.githubusercontent.com/askming/picgo/master/JP2bBA_2021_07_07.jpg" /></p>
</li>
<li><p>Incidentally, this is another explanation for why there’s no easy way to query an object for the environment that owns it. When we are executing in an environment, we are interested in the objects it owns because we might be looking for one of them. When we find a function we need to know which environment to execute it within. But its not important in our workflow to identify an arbitrary object’s owning environment.</p></li>
</ul>
</div>
<div class="section" id="passing-functions">
<h2>Passing Functions<a class="headerlink" href="#passing-functions" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>If a function <code class="docutils literal notranslate"><span class="pre">FunctionA(</span> <span class="pre">someOtherFunction</span> <span class="pre">)</span></code> takes another function <code class="docutils literal notranslate"><span class="pre">someOtherFunction</span></code> as a parameter then <code class="docutils literal notranslate"><span class="pre">FunctionA</span></code> must have some variability in the way it runs. That variability is governed by the implementation of <code class="docutils literal notranslate"><span class="pre">someOtherFunction</span></code>. When we construct <code class="docutils literal notranslate"><span class="pre">someOtherFunction</span></code>, we expect it to run in a particular way. <code class="docutils literal notranslate"><span class="pre">someOtherFunction</span></code> should have access to the objects in the environment in which it was constructed. That expectation doesn’t change when the function is handed-off to <code class="docutils literal notranslate"><span class="pre">FunctionA</span></code> . But R creates a new environment for <code class="docutils literal notranslate"><span class="pre">FunctionA</span></code>. Thankfully that’s not a problem. When <code class="docutils literal notranslate"><span class="pre">someOtherFunction</span></code> is finally run R looks to the function’s environment property and executes within <em>that</em> environment, not within <code class="docutils literal notranslate"><span class="pre">FunctionA</span></code>’s environment. So the integrity of our expectation is upheld. In fact, <code class="docutils literal notranslate"><span class="pre">FunctionA</span></code> can pass <code class="docutils literal notranslate"><span class="pre">someOtherFunction</span></code> to <code class="docutils literal notranslate"><span class="pre">FunctionB</span></code> which in turn can pass the function to <code class="docutils literal notranslate"><span class="pre">FunctionC</span></code> and it has no consequence on how <code class="docutils literal notranslate"><span class="pre">someOtherFunction</span></code> will run. That’s the magic of a function’s environment property.</p></li>
</ul>
</div>
<div class="section" id="that-creepy-caller">
<h2>That Creepy Caller<a class="headerlink" href="#that-creepy-caller" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The call stack is the sequence of function calls that has gotten you to wherever you currently are in the calculation. For example, <code class="docutils literal notranslate"><span class="pre">FunctionA</span></code> calls <code class="docutils literal notranslate"><span class="pre">FunctionB</span></code> which in turn calls <code class="docutils literal notranslate"><span class="pre">FunctionC</span></code>. The call stack just places each of those functions on top of one another in the order in which they were called. Lets say <code class="docutils literal notranslate"><span class="pre">FunctionC</span></code> needs to execute <code class="docutils literal notranslate"><span class="pre">FunctionD</span></code>. The <em>wrong</em> way to think about the search mechanism is to follow the callers.</p></li>
<li><p>Unfortunately, the call stack is more intuitive than the chain of enclosing environments. Just remember, whenever R is evaluating a statement the system is simultaneously at the top (or bottom if it’s easier to visualize that way) of <em>two</em> important chains of environments.</p>
<ul>
<li><p>One is the <strong>chain of enclosing environments</strong> which is involved in the task of scoping (i.e. where to look next for variable names not found in the frame of the current environment). <em>This is the chain we care about.</em></p></li>
<li><p>The other <strong>chain is the call stack</strong>, which is produced by the sequence of function calls. <em>You can ignore this chain</em>.</p></li>
<li><p>There <em>are</em> scenarios where it’s necessary to look for a variable via the call stack, but to accomplish that you have to use some special functions in R.</p></li>
</ul>
</li>
<li><p><strong>A word of caution:</strong> R (and some R literature) uses the term “parent” in context of both chains. There’s the function <code class="docutils literal notranslate"><span class="pre">parent.env()</span></code> which we already know and <code class="docutils literal notranslate"><span class="pre">parent.frame()</span></code> which is used to interrogate the call stack. This is certainly confusing and its a historic slip-up. The term “parent” should <em>not</em> be used as a substitute for enclosing environments. It should only be used with the call stack.</p></li>
</ul>
</div>
<div class="section" id="finally-how-r-searches-and-finds-stuff">
<h2>Finally, How R searches and finds stuff<a class="headerlink" href="#finally-how-r-searches-and-finds-stuff" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>R just follows the purple line road</strong> in our map above.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">ggplot</span></code> is not in the global environment, then it must be in a package. So R travels down the search list looking for <code class="docutils literal notranslate"><span class="pre">ggplot</span></code>. This is simply the chain of enclosing environments starting with <code class="docutils literal notranslate"><span class="pre">R_Global</span></code>. R ultimately find the function in one of the package environments. Although <code class="docutils literal notranslate"><span class="pre">ggplot</span></code> is found within the <code class="docutils literal notranslate"><span class="pre">package</span></code> environment, R executes <code class="docutils literal notranslate"><span class="pre">ggplot</span></code> within the <code class="docutils literal notranslate"><span class="pre">namespace</span></code> environment as described in the prior section. In this case, we’ve found <code class="docutils literal notranslate"><span class="pre">ggplot</span></code> in <code class="docutils literal notranslate"><span class="pre">package:ggplot2</span></code> and we execute the function within <code class="docutils literal notranslate"><span class="pre">namespace:ggplot2</span></code>.</p></li>
<li><p>Lets say <code class="docutils literal notranslate"><span class="pre">ggplot</span></code> calls another function <code class="docutils literal notranslate"><span class="pre">MyFunction</span></code>. A few things can happen:</p>
<ol class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">MyFunction</span></code> is defined within <code class="docutils literal notranslate"><span class="pre">ggplot</span></code>, then we find it immediately since R checks the local environment first. In this case the local environment is the environment created to run <code class="docutils literal notranslate"><span class="pre">ggplot</span></code></p></li>
<li><p>If not found, then R looks to the enclosing environment of <code class="docutils literal notranslate"><span class="pre">MyFunction</span></code>’s executing environment which is <code class="docutils literal notranslate"><span class="pre">namespace:ggplot2</span></code>. If we find <code class="docutils literal notranslate"><span class="pre">MyFunction</span></code> here, then it’s a case of a package function calling another function in the same package.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">MyFunction</span></code> is not in the <code class="docutils literal notranslate"><span class="pre">namespace:ggplot2</span></code>, then R checks the enclosing environment of the namespace environment which is the <strong>imports environment</strong>. This gives <code class="docutils literal notranslate"><span class="pre">ggplot</span></code> an opportunity to find <code class="docutils literal notranslate"><span class="pre">MyFunction</span></code> within a set of explicitly defined package dependencies. This is like ggplot finding a plyr function in our example above.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">MyFunction</span></code> is not in the imports environment, then we check the enclosing environment of the imports environment which is <code class="docutils literal notranslate"><span class="pre">namespace:base</span></code>. A base function (i.e. sd() for standard deviation) would be found here and the search would be complete.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">MyFunction</span></code> is not found in <code class="docutils literal notranslate"><span class="pre">namespace:base</span></code>, then we are back to the search list. We start by checking <code class="docutils literal notranslate"><span class="pre">R_GlobalEnv</span></code>. Its unlikely that <code class="docutils literal notranslate"><span class="pre">MyFunction</span></code> is in <code class="docutils literal notranslate"><span class="pre">R_GlobalEnv</span></code>. It would be poor practice for a package to expect the user to define some function in the global environment. However, the user could take this as an opportunity to intercept the search by defining her own version of <code class="docutils literal notranslate"><span class="pre">MyFunction</span></code> in the global environment.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">MyFunction</span></code> is within a package that’s a dependency of <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> and that dependency is specified in<code class="docutils literal notranslate"> <span class="pre">Depends</span></code> rather than <code class="docutils literal notranslate"><span class="pre">Imports</span></code>, then the search list is where we would find <code class="docutils literal notranslate"><span class="pre">MyFunction</span></code>.</p></li>
</ol>
</li>
</ul>
</div>
<div class="section" id="qualitative-comments">
<h2>Qualitative Comments<a class="headerlink" href="#qualitative-comments" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>If we are executing outside of a package (as in <code class="docutils literal notranslate"><span class="pre">R_GlobalEnv</span></code>) it enables us to find functions inside packages. If we are inside a package it allows the package functions to find the specified dependencies. If we are inside a package or a package’s imports (dependencies), then we have a buffer of base functions before we plunging into the search list. Also, the design ensures that we terminate at <code class="docutils literal notranslate"><span class="pre">R_EmptyEnv</span></code> if a named object cannot be found, no matter where on the map we are.</p></li>
</ul>
</div>
<div class="section" id="skip-the-search-and-find">
<h2>Skip the search-and-find<a class="headerlink" href="#skip-the-search-and-find" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>f you know exactly which package contains the object desired then you can reference it directly using the <code class="docutils literal notranslate"><span class="pre">::</span></code> operator. Simply place the package name before the operator and the name of the object after the operator to retrieve it.</p></li>
<li><p>If the object is not exported or you are unsure, then you can use the <code class="docutils literal notranslate"><span class="pre">:::</span></code> operator (notice the extra colon).</p>
<ul>
<li><p>This operator searches the namespace environment for the given object (as we discussed, non-exported objects do not appear in the package environment, only in the namespace environment).</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="c1"># view the ::: operator function</span>
<span class="o">&gt;</span> <span class="n">`:::`</span> 
<span class="nf">function </span><span class="p">(</span><span class="n">pkg</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> 
<span class="p">{</span> 
    <span class="n">pkg</span> <span class="o">&lt;-</span> <span class="nf">as.character</span><span class="p">(</span><span class="nf">substitute</span><span class="p">(</span><span class="n">pkg</span><span class="p">))</span> 
    <span class="n">name</span> <span class="o">&lt;-</span> <span class="nf">as.character</span><span class="p">(</span><span class="nf">substitute</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> 
    <span class="nf">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">envir</span> <span class="o">=</span> <span class="nf">asNamespace</span><span class="p">(</span><span class="n">pkg</span><span class="p">),</span> <span class="n">inherits</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> 
<span class="p">}</span> 
<span class="o">&lt;</span><span class="n">bytecode</span><span class="o">:</span> <span class="m">00000000073</span><span class="n">BAEA8</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">environment</span><span class="o">:</span> <span class="n">namespace</span><span class="o">:</span><span class="n">base</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="id2"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>The latter, the “hidden” objects (they are not really hidden, you can access them if you’d like) facilitate the “visible” ones.</p>
</dd>
</dl>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Stats_Comp"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="../Stats/Note-Survival_Analysis.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Survival Analysis</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="../DS_ML/Book-Hands-On%20Machine%20Learning%20with%20Scikit-Learn%20and%20TensorFlow.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">[book] Hands-On Machine Learning with Scikit-Learn and TensorFlow</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By askming<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>